<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Logseq/Advanced_queries_Examples | Charles Chiu</title><meta name=keywords content><meta name=description content="This page is a collection of some of the Advanced queries from the Datalog channel on the Logseq/Discord server.
Resources   link: The first message on the datalog channel
  link: Logseq docs - Advanced queries
  link: Logseq datascript schema
  link: Logseq frontend db model
  link: How to Graph Your Data - talk by Paula Gearon
  link: Domain modelling with datalog - talk by Norbert Wojtowicz"><meta name=author content="Charles Chiu"><link rel=canonical href=https://charleschiugit.github.io/pages/logseq/advanced_queries_examples/><link crossorigin=anonymous href=/assets/css/stylesheet.min.49b1c3611e5e823e974d0b9b3e1101617fce26c004757161abb1a1e4af3ff85c.css integrity="sha256-SbHDYR5egj6XTQubPhEBYX/OJsAEdXFhq7Gh5K8/+Fw=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://charleschiugit.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://charleschiugit.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://charleschiugit.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://charleschiugit.github.io/apple-touch-icon.png><link rel=mask-icon href=https://charleschiugit.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.97.3"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Logseq/Advanced_queries_Examples"><meta property="og:description" content="This page is a collection of some of the Advanced queries from the Datalog channel on the Logseq/Discord server.
Resources   link: The first message on the datalog channel
  link: Logseq docs - Advanced queries
  link: Logseq datascript schema
  link: Logseq frontend db model
  link: How to Graph Your Data - talk by Paula Gearon
  link: Domain modelling with datalog - talk by Norbert Wojtowicz"><meta property="og:type" content="article"><meta property="og:url" content="https://charleschiugit.github.io/pages/logseq/advanced_queries_examples/"><meta property="article:section" content="pages"><meta property="article:published_time" content="2022-04-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Logseq/Advanced_queries_Examples"><meta name=twitter:description content="This page is a collection of some of the Advanced queries from the Datalog channel on the Logseq/Discord server.
Resources   link: The first message on the datalog channel
  link: Logseq docs - Advanced queries
  link: Logseq datascript schema
  link: Logseq frontend db model
  link: How to Graph Your Data - talk by Paula Gearon
  link: Domain modelling with datalog - talk by Norbert Wojtowicz"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Pages","item":"https://charleschiugit.github.io/pages/"},{"@type":"ListItem","position":3,"name":"Logseq/Advanced_queries_Examples","item":"https://charleschiugit.github.io/pages/logseq/advanced_queries_examples/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Logseq/Advanced_queries_Examples","name":"Logseq\/Advanced_queries_Examples","description":"This page is a collection of some of the Advanced queries from the Datalog channel on the Logseq/Discord server.\nResources   link: The first message on the datalog channel\n  link: Logseq docs - Advanced queries\n  link: Logseq datascript schema\n  link: Logseq frontend db model\n  link: How to Graph Your Data - talk by Paula Gearon\n  link: Domain modelling with datalog - talk by Norbert Wojtowicz","keywords":[],"articleBody":"This page is a collection of some of the Advanced queries from the Datalog channel on the Logseq/Discord server.\nResources   link: The first message on the datalog channel\n  link: Logseq docs - Advanced queries\n  link: Logseq datascript schema\n  link: Logseq frontend db model\n  link: How to Graph Your Data - talk by Paula Gearon\n  link: Domain modelling with datalog - talk by Norbert Wojtowicz\n  link: Athens Research ClojureFam\n  link: Learn datalog today\n  link: Uday Verma’s Blog: Datascript 101\n  link: ClojureScript Cheatsheet\n  link: Hiccup syntax\n  link: Logseq datascript\n  link: Advanced queries tutorial\n  Queries   Query to search a textual input link:: Discord date:: 2021-03-16\n  #+BEGIN_QUERY {:title “Advanced query to search for the text ‘Quantum mechanics’” :query [:find (pull ?b [*]) :in $ ?pattern :where [?b :block/content ?c] [(re-pattern ?pattern) ?q] [(re-find ?q ?c)]] :inputs [“Quantum mechanics”] :collapsed? true} #+END_QUERY\n  Equivalent to {{query \"Quantum mechanics\"}}\n    Find all TODO tasks outside of the journal pages link:: Discord date:: 2021-03-24\n #+BEGIN_QUERY {:title [:h2.font-bold.opacity-70 “TODO”]  :query [ :find (pull ?h [*]) :where [?h :block/marker ?marker] [(= ?marker “TODO”)] ] :result-transform (fn [result] (sort-by (fn [h] (get h :block/priority “Z”)) result)) :collapsed? true}\n  #+END_QUERY\n  All TODO blocks recursively related to a tag or page link:: Discord date:: 2021-03-27\n  How would you query for all TODO blocks that are tagged or recursively related to ancestor block/page that is tagged with a specific tag? For example, I want all TODO tasks that are tagged as clojure or contained under blocks or pages (in any indentation depth) that are tagged clojure. That way I can see all the clojure related articles I haven’t read yet, without having to tag them all explicitly. link:: Discord\n  #+BEGIN_QUERY {:title “All TODO items related to the tag ‘Cowling’ \" :query [:find (pull ?b [*]) :where [?b :block/marker “TODO”] [?b :block/page ?p] (or [?b :block/path-ref-pages [:page/name “cowl”]]\n[?p :page/tags [:page/name “cowl”]])\n    ] :collapsed? true} #+END_QUERY\n  Scheduled items and deadlines from the past week link:: Discord date:: 2021-04-01\n  Hey, I try to find Schedules or Due dates that are in-between specific dates, but whenever they contain a marker (TODO, NOW, …) they should only show if that marker is not completed. Unfortunately, I’m not familiar with Datomic or Clojure at all.. link:: Discord\n  #+BEGIN_QUERY {:title “?�� SLIPPING deadlines ( :query [:find (pull ?block [*]) :in $ ?start ?today :where (or [?block :block/scheduled ?d] [?block :block/deadline ?d]) (not [?block :block/marker ?marker] (not [(contains? #{“NOW” “LATER” “TODO” “DOING”} ?marker)])) [(= ?d ?start)] [( #+END_QUERY\n  Find all unlinked pages link:: Discord date:: 2021-04-16\n  query-table:: false #+BEGIN_QUERY {:title “Orphan pages” :query [:find ?name\n:where [?p :page/name ?name] (not [?b :block/ref-pages ?p1] [?b :block/page ?p2] (or [?p1 :page/name ?name] [?p2 :page/name ?name]))]\n    :view (fn [result]\n [:div.flex.flex-col (for [page result] [:a {:href (str \"/page/\" page)} (clojure.string/capitalize page)])])  :collapsed? true} #+END_QUERY\n  List of currently DOING tasks link:: Discord date:: 2021-05-30\n query-table:: false    #+BEGIN_QUERY {:title “?�� DOING”\n:query [:find (pull ?b [*]) :where [?b :block/marker ?marker] [(contains? #{\"NOW\" \"DOING\"} ?marker)]]  :breadcrumb-show? false :result-transform (fn [result]\n (sort-by (fn [h] (get h :block/priority \"Z\")) result)) :collapsed? true}  #+END_QUERY\n  Query to show random block link:: Discord date:: 2021-07-21\n  #+BEGIN_QUERY {:title “Give me a random block!!!” :query [:find (pull ?b [*])\n:where [?b :block/content ?content] (not [(empty? ?content)])]\n    :result-transform (fn [result]\n [(rand-nth result)])  :collapsed? true} #+END_QUERY\n  Query to show a random page link:: Discord date:: 2021-07-21\n  #+BEGIN_QUERY {:title “Give me a random page!!!” :query [:find ?name\n:where [?b :block/name ?name]]\n    :result-transform (fn [result]\n [(rand-nth result)])  :view (fn [result]\n [:div.flex.flex-col (for [page result] [:a {:href (str \"/#/page/\" page)} (clojure.string/capitalize page)])])  :collapsed? true} #+END_QUERY\n  Search by block uuid link:: Discord date:: 2021-07-24\n  #+BEGIN_QUERY {:query [:find (pull ?b [*]) :in $ ?uuid\n:where [?b :block/uuid ?u] [(str ?u) ?s] [(= ?uuid ?s)]]\n    :inputs [“61d9ce9c-0822-4c1d-a9f3-78537657155b”] } #+END_QUERY\n  Query backlog TODO and DOING tasks link:: Discord date:: 2021-07-24\n  #+BEGIN_QUERY {:title “Backlog” :query [:find (pull ?todo [*]) :in $ ?current-page :where [?p :block/name ?current-page] [?todo :block/marker ?marker] (not [?todo :block/page ?p]) (not [_ :block/refs ?todo]) [(contains? #{“TODO” “DOING”} ?marker)] ] :inputs [:current-page] :breadcrumb-show? false :result-transform (fn [result]\n (sort-by (fn [h] (get h :block/priority \"Z\")) result))      :collapsed? true} #+END_QUERY\n  Search for a keyword within a specific set of pages link:: Discord, Discord date:: 2021-07-24\n  #+BEGIN_QUERY {:title “Siloed search” :query [:find (pull ?b [*])\n:in $ ?keyword [?title …] :where [?p :block/original-name ?title] [?b :block/page ?p] [?b :block/content ?c] [(clojure.string/includes? ?c ?keyword)]]\n    :inputs [“tasks” [“Advanced queries” “Advanced queries/Examples”]] } #+END_QUERY\n+ #+BEGIN_QUERY  {:title “Siloed search” :query [:find (pull ?b [*])\n :in $ ?keyword [?title ...] :where [(str \"(?i)\" ?keyword) ?matcher] [(re-pattern ?matcher) ?regex] [?p :block/original-name ?title] [?b :block/page ?p] [?b :block/content ?c] [(re-find ?regex ?c)]]  :inputs [“tasks” [“Advanced queries” “Advanced queries/Examples”]] } #+END_QUERY\n  Broken references link:: Discord date:: 2021-07-26\n  #+BEGIN_QUERY {:title “Broken References” :query [:find (pull ?b [*])\n:in $ ?matcher :where [(re-pattern ?matcher) ?regex] [?b :block/content ?c] [(re-find ?regex ?c)] [(missing? $ ?b :block/refs)]]\n    :inputs [ “\\([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\\)”] } #+END_QUERY\n  Current NOW and DOING tasks for pages tagged with “project” link:: Discord date:: 2021-08-24\n #+BEGIN_QUERY {:title “?�� Project Now”  :query [:find (pull ?h [*]) :in $ ?searchterm :where [?h :block/marker ?marker] [(contains? #{“NOW” “DOING”} ?marker)] [?p :block/properties ?a] [(get ?a :type) ?t] [(= ?searchterm ?t)] [?br :block/name ?searchterm] (or [?h :block/page ?p] [?h :block/refs ?br]) ] :inputs [“project”] :result-transform (fn [result] (sort-by (fn [h] (get h :block/priority “Z”)) result)) :collapsed? false}\n  #+END_QUERY\n  Querying TODOs from hierarchy pages link:: Discord date:: 2021-08-06\n  #+BEGIN_QUERY {:query [:find (pull ?b [*])\n:in $ ?s :where [?b :block/marker “DONE”] [?b :block/page ?p] [?p :block/original-name ?n] [(clojure.string/starts-with? ?n ?s)]]\n    :inputs [ “Advanced queries/” ] } #+END_QUERY\n+ DONE Completed this query   List all the pages updated in the last 3 days  link:: Discord, Discord date:: 2021-09-06, 2021-09-09\n+ The time entered in the Unix time stamp (see https://www.unixtimestamp.com) which is the number of milliseconds since Jan 1st 1970.  query-properties:: [:page :updated-at]\n+ We may have to multiply with 1000 to get the result in milliseconds, if using the above site. + query-sort-by:: updated-at  query-sort-desc:: true query-properties:: [:page :updated-at] #+BEGIN_QUERY {:title [:h3 “Updated in last 3 days”] :query [:find (pull ?b [*]) :in $ ?end :where [?b :block/updated-at ?v] [(- ?end 259200000 ) ?period] [(= ?v ?period)] [( Query for TODO and LATER but excluding SCHEDULED tasks link:: Discord date:: 2021-09-18\n #+BEGIN_QUERY {:query [:find (pull ?b [*]) :where [?b :block/marker ?m] [(contains? #{“TODO” “LATER”} ?m)] [(missing? $ ?b :block/scheduled)] [(missing? $ ?b :block/deadline)] ] } #+END_QUERY    Query for a task having a given block property link:: Discord date:: 2021-09-19\n  #+BEGIN_QUERY {:title “My TASKS (type: example)” :query [:find (pull ?b [*]) :where [?b :block/marker ?marker] [(contains? #{“DONE”} ?marker)] [?b :block/properties ?prop] [(get ?prop :type) ?type] [(= “example” ?type)] ] :collapsed? false} #+END_QUERY\n  DONE Check query with task and property. type:: example\n    List all projects (type:: project) that do not have any TODOs on their pages link:: Discord date:: 2021-09-25\n #+BEGIN_QUERY {:query[:find (pull ?p [*]) :where [?b :block/page ?p] [?p :block/properties ?props] [(get ?props :type) ?type] [(= ?type “project”)] (not-join [?p]  [?b :block/page ?p] [?b :block/marker _]) ]}\n  #+END_QUERY\n List all the projects with page property “status” as :Active  link:: Discord date:: 2021-9-27\n+ #+BEGIN_QUERY  {:query[:find (pull ?p [*]) :where [?b :block/page ?p] [?p :block/properties ?props] [(get ?props :status) ?status] [(= ?status #{“Active”})]]} #+END_QUERY\n Query all tasks excluding those on a page Journal reviews]]  link:: Discord, Discord date:: 2021-09-27\n+ #+BEGIN_QUERY  {:title “?�� TESTING”\n :query [:find (pull ?b [*]) :where [?b :block/marker ?marker] [(missing? $ ?b :block/scheduled)] [(missing? $ ?b :block/deadline)] [(contains? #{\"LATER\" \"TODO\"} ?marker)] [?b :block/page ?page] [?page :block/original-name ?name] (not[(= ?name \"Journal reviews\")])]  } #+END_QUERY\n+ #+BEGIN_QUERY  {:title “Main Tasks”\n :query [:find (pull ?b [*]) :where [?b :block/marker ?marker] [(missing? $ ?b :block/scheduled)] [(missing? $ ?b :block/deadline)] [(contains? #{\"LATER\" \"TODO\"} ?marker)] (not [?b :block/path-refs [:block/name \"test\"]]) [?b :block/page ?page] [?page :block/original-name ?name] (not[(= ?name \"Journal reviews\")])]  :breadcrumb-show? false :result-transform (fn [result]\n (sort-by (fn [h] (get h :block/created-at)) result))  :collapsed? true } #+END_QUERY\n DONE Query all scheduled/deadlined tasks and sort them by scheduled or deadline date link:: Discord date:: 2021-10-13  SCHEDULED: + #+BEGIN_QUERY  {:title “?�� Future Tasks” :query [:find (pull ?block [*])\n :in $ ?start ?next :where [?block :block/marker ?marker] [(contains? #{\"NOW\" \"LATER\" \"TODO\" \"DOING\" \"WAITING\"} ?marker)] (or [?block :block/scheduled ?d] [?block :block/deadline ?d]) [(= ?d ?start)] [( :inputs [:today :365d-after] :breadcrumb-show? false :result-transform (fn [result]\n (sort-by (fn [b] (or (get b :block/scheduled) (get b :block/deadline))) result))  :collapsed? true } #+END_QUERY\n  All tasks with priority A link:: Discord date:: 2021-10-14\n  #+BEGIN_QUERY {:title “All todos that with priority A” :query [:find (pull ?b [*])\n:where [?b :block/priority “A”]]}\n    #+END_QUERY\n  Query snippet to grab the children blocks link:: Discord date:: 2021-10-23\n Replace (pull ?h [*]) with:    #+BEGIN_QUERY (pull ?h [  :db/id  :block/uuid  :block/type  :block/left  :block/format  :block/title  :block/refs  :block/_refs  :block/path-refs  :block/tags  :block/content  :block/marker  :block/priority  :block/properties  :block/body  :block/pre-block?  :block/scheduled  :block/deadline  :block/repeated?  :block/created-at  :block/updated-at  :block/file  :block/parent  :block/unordered  :block/heading-level  {:block/page  [:db/id :block/name :block/original-name :block/journal-day]}  {:block/_parent ...}])  Query for non-task blocks with a schedule/deadline in the past  link:: Discord date:: 2021-11-04\n+ query-table:: false  #+BEGIN_QUERY {:title “Old Blocks” :query [:find (pull ?b [*])\n :in $ ?start :where (or [?b :block/scheduled ?d] [?b :block/deadline ?d]) [( :inputs [:today] :collapsed? false} #+END_QUERY\n  Query to find tasks under a block containing the text “Follow-up” link:: Discord date:: 2021-12-10\n  Follow-up\n  DONE find this block\n  #+BEGIN_QUERY {:title “Find: Follow-up Tasks” :query [:find (pull ?b [*]) :where\n    [?p :block/content “Follow-up”] [?b :block/parent ?p] [?b :block/marker ?marker] [(contains? #{“TODO” “DOING” “DONE”} ?marker)]]\n  } #+END_QUERY\n  Query all pages that have been created in the last 2 days link:: Discord date:: 2021-12-15\n  query-properties:: [:page :created-at] #+BEGIN_QUERY {:title “Pages in last 2 days” :query [:find (pull ?p [*])\n :in $ ?today :where [?p :block/created-at ?d] [(- ?today 172800000) ?start] [(= ?d ?start)] [(   ]\n  :inputs [:right-now-ms]} #+END_QUERY\n+ `172800000` is 2 days in ms.    Query to create a table with page and todo count link:: Discord date:: 2021-12-17\n query-table:: false #+BEGIN_QUERY {:title “TODO by page” :query [:find (pull ?b [:block/marker :block/parent {:block/page  [:db/id :block/name]}])\n  :where\n [?b :block/marker ?marker] [(= \"TODO\" ?marker)]  ] :result-transform (fn [result]\n (map (fn key value {:page (get key :block/name) :count (count value)}) (group-by :block/page result)) )  :view (fn [rows] [:table [:thead [:tr [:th “Page”] [:th “Count”] ] ] [:tbody (for [r rows] [:tr [:td [:a {:href (str “#/page/” (get r :page))} (get r :page)] ] [:td (get r :count)] ]) ]] ) } #+END_QUERY\n  Simple query to finds all the tasks created today link:: Discord, Discord, Discord date:: 2021-12-22\n  {{query (and (between -0d ++0d) (task TODO))}}\n  d is used to indicate a day. 0d means 0 days or today. Think of it this way: Between -0d and ++0d\n = between today-1 and today+1 = between yesterday and tommrow = today    ++1d transformed to todays date +1d transformed to tomorrow -1d transformed to yesterday\n    Query all blocks on the current page having a specific tag, say “#datalog” link:: Discord date:: 2021-12-24\n #+BEGIN_QUERY {  :query [ :find (pull ?b [*]) :in $ ?current-page :where [?p :block/name ?current-page] [?b :block/page ?p] [?b :block/path-refs [:block/name “datalog”]] ] :inputs [:current-page]}\n  } #+END_QUERY\n Query to create a table from “birthday” property of a page   query-table:: false query-properties:: [:alias :birthday] #+BEGIN_QUERY { :query [:find (pull ?b [*])\n:where [?b :block/properties ?bprops] [(get ?bprops :birthday “nil”) ?bs] [(not= ?bs “nil”)]]\n    :result-transform (fn [result]\n(sort-by (fn [h] (get-in h [:block/properties :verjaardag])) result))  } #+END_QUERY\n","wordCount":"1894","inLanguage":"en","datePublished":"2022-04-08T00:00:00Z","dateModified":"2022-04-21T00:00:00Z","author":{"@type":"Person","name":"Charles Chiu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://charleschiugit.github.io/pages/logseq/advanced_queries_examples/"},"publisher":{"@type":"Organization","name":"Charles Chiu","logo":{"@type":"ImageObject","url":"https://charleschiugit.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://charleschiugit.github.io accesskey=h title="Charles Chiu (Alt + H)">Charles Chiu</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://charleschiugit.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://charleschiugit.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://charleschiugit.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://charleschiugit.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Logseq/Advanced_queries_Examples</h1><div class=post-meta><span title="2022-04-08 00:00:00 +0000 UTC">April 8, 2022</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Charles Chiu</div></header><div class=post-content><p>This page is a collection of some of the Advanced queries from the Datalog channel on the Logseq/Discord server.</p><h3 id=resources>Resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h3><ul><li><p><a href=https://discord.com/channels/725182569297215569/743139225746145311/743139795865174119>link: The first message on the datalog channel</a></p></li><li><p><a href=https://docs.logseq.com/#/page/advanced%20queries>link: Logseq docs - Advanced queries</a></p></li><li><p><a href=https://gist.github.com/tiensonqin/9a40575827f8f63eec54432443ecb929>link: Logseq datascript schema</a></p></li><li><p><a href=https://github.com/logseq/logseq/blob/master/src/main/frontend/db/model.cljs>link: Logseq frontend db model</a></p></li><li><p><a href=https://youtu.be/tbVwmFBnfo4>link: How to Graph Your Data - talk by Paula Gearon</a></p></li><li><p><a href=https://youtu.be/oo-7mN9WXTw>link: Domain modelling with datalog - talk by Norbert Wojtowicz</a></p></li><li><p><a href=https://github.com/athensresearch/ClojureFam>link: Athens Research ClojureFam</a></p></li><li><p><a href=http://www.learndatalogtoday.org>link: Learn datalog today</a></p></li><li><p><a href=https://udayv.com/blog/2016-04-28-datascript101/>link: Uday Verma&rsquo;s Blog: Datascript 101</a></p></li><li><p><a href=https://cljs.info/cheatsheet/>link: ClojureScript Cheatsheet</a></p></li><li><p><a href=https://github.com/weavejester/hiccup/wiki/Syntax>link: Hiccup syntax</a></p></li><li><p><a href=https://github.com/logseq/datascript/blob/fork/src/datascript/query.cljc>link: Logseq datascript</a></p></li><li><p><a href=https://mschmidtkorth.github.io/logseq-msk-docs/#/page/advanced%20queries%20tutorial>link: Advanced queries tutorial</a></p></li></ul><h3 id=queries>Queries<a hidden class=anchor aria-hidden=true href=#queries>#</a></h3><ul><li><p><strong>Query to search a textual input</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/821317203910721577>Discord</a>
date:: 2021-03-16</p><ul><li><p>#+BEGIN_QUERY
{:title &ldquo;Advanced query to search for the text &lsquo;Quantum mechanics&rsquo;&rdquo;
:query
[:find (pull ?b [*])
:in $ ?pattern
:where
[?b :block/content ?c]
[(re-pattern ?pattern) ?q]
[(re-find ?q ?c)]]
:inputs [&ldquo;Quantum mechanics&rdquo;]
:collapsed? true}
#+END_QUERY</p></li><li><p>Equivalent to <code>{{query "Quantum mechanics"}}</code></p></li></ul></li><li><p><strong>Find all TODO tasks outside of the journal pages</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/824060683947737138>Discord</a>
date:: 2021-03-24</p><ul><li>#+BEGIN_QUERY
{:title [:h2.font-bold.opacity-70 &ldquo;TODO&rdquo;]</li></ul><p>:query [
:find (pull ?h [*])
:where
[?h :block/marker ?marker]
[(= ?marker &ldquo;TODO&rdquo;)]
]
:result-transform (fn [result]
(sort-by (fn [h]
(get h :block/priority &ldquo;Z&rdquo;)) result))
:collapsed? true}</p></li></ul><p>#+END_QUERY</p><ul><li><p><strong>All TODO blocks recursively related to a tag or page</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/825330146780381205>Discord</a>
date:: 2021-03-27</p><ul><li><p>How would you query for all TODO blocks that are tagged or recursively related to ancestor block/page that is tagged with a specific tag? For example, I want all TODO tasks that are tagged as clojure or contained under blocks or pages (in any indentation depth) that are tagged clojure. That way I can see all the clojure related articles I haven&rsquo;t read yet, without having to tag them all explicitly.
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/825074937651396678>Discord</a></p></li><li><p>#+BEGIN_QUERY
{:title &ldquo;All TODO items related to the tag &lsquo;Cowling&rsquo; "
:query
[:find (pull ?b [*])
:where
[?b :block/marker &ldquo;TODO&rdquo;]
[?b :block/page ?p]
(or [?b :block/path-ref-pages [:page/name &ldquo;cowl&rdquo;]]</p><p>[?p :page/tags [:page/name &ldquo;cowl&rdquo;]])</p></li></ul></li></ul><p>]
:collapsed? true}
#+END_QUERY</p><ul><li><p><strong>Scheduled items and deadlines from the past week</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/827098887826964490>Discord</a>
date:: 2021-04-01</p><ul><li><p>Hey, I try to find Schedules or Due dates that are in-between specific dates, but whenever they contain a marker (TODO, NOW, &mldr;) they should only show if that marker is not completed. Unfortunately, I&rsquo;m not familiar with Datomic or Clojure at all..
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/826412758438248458>Discord</a></p></li><li><p>#+BEGIN_QUERY
{:title &ldquo;?�� SLIPPING deadlines (&lt;1W)&rdquo;</p></li></ul><p>:query [:find (pull ?block [*])
:in $ ?start ?today
:where
(or
[?block :block/scheduled ?d]
[?block :block/deadline ?d])
(not
[?block :block/marker ?marker]
(not [(contains? #{&ldquo;NOW&rdquo; &ldquo;LATER&rdquo; &ldquo;TODO&rdquo; &ldquo;DOING&rdquo;} ?marker)]))
[(>= ?d ?start)]
[(&lt;= ?d ?today)]]
:inputs [:8d :today]
:collapsed? true}</p></li></ul><p>#+END_QUERY</p><ul><li><p><strong>Find all unlinked pages</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/832512082289229824>Discord</a>
date:: 2021-04-16</p><ul><li><p>query-table:: false
#+BEGIN_QUERY
{:title &ldquo;Orphan pages&rdquo;
:query [:find ?name</p><p>:where
[?p :page/name ?name]
(not
[?b :block/ref-pages ?p1]
[?b :block/page ?p2]
(or [?p1 :page/name ?name]
[?p2 :page/name ?name]))]</p></li></ul></li></ul><p>:view (fn [result]</p><pre><code>     [:div.flex.flex-col
      (for [page result]
        [:a {:href (str &quot;/page/&quot; page)} (clojure.string/capitalize page)])])
</code></pre><p>:collapsed? true}
#+END_QUERY</p><ul><li><p><strong>List of currently DOING tasks</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/848575612385624074>Discord</a>
date:: 2021-05-30</p><ul><li>query-table:: false</li></ul></li></ul><p>#+BEGIN_QUERY
{:title &ldquo;?�� DOING&rdquo;</p><pre><code>:query [:find (pull ?b [*])
    :where
      [?b :block/marker ?marker]
      [(contains? #{&quot;NOW&quot; &quot;DOING&quot;} ?marker)]]
</code></pre><p>:breadcrumb-show? false
:result-transform (fn [result]</p><pre><code>     (sort-by (fn [h]
     (get h :block/priority &quot;Z&quot;))
   result))
:collapsed? true}
</code></pre><p>#+END_QUERY</p><ul><li><p><strong>Query to show random block</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/867362494871765002>Discord</a>
date:: 2021-07-21</p><ul><li><p>#+BEGIN_QUERY
{:title &ldquo;Give me a random block!!!&rdquo;
:query [:find (pull ?b [*])</p><p>:where
[?b :block/content ?content]
(not [(empty? ?content)])]</p></li></ul></li></ul><p>:result-transform (fn [result]</p><pre><code>                 [(rand-nth result)])
</code></pre><p>:collapsed? true}
#+END_QUERY</p><ul><li><p><strong>Query to show a random page</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/867375290396311633>Discord</a>
date:: 2021-07-21</p><ul><li><p>#+BEGIN_QUERY
{:title &ldquo;Give me a random page!!!&rdquo;
:query [:find ?name</p><p>:where
[?b :block/name ?name]]</p></li></ul></li></ul><p>:result-transform (fn [result]</p><pre><code>                 [(rand-nth result)])
</code></pre><p>:view (fn [result]</p><pre><code>   [:div.flex.flex-col
    (for [page result]
      [:a {:href (str &quot;/#/page/&quot; page)} (clojure.string/capitalize page)])])
</code></pre><p>:collapsed? true}
#+END_QUERY</p><ul><li><p><strong>Search by block uuid</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/868359519678398504>Discord</a>
date:: 2021-07-24</p><ul><li><p>#+BEGIN_QUERY
{:query [:find (pull ?b [*]) :in $ ?uuid</p><p>:where
[?b :block/uuid ?u]
[(str ?u) ?s]
[(= ?uuid ?s)]]</p></li></ul></li></ul><p>:inputs [&ldquo;61d9ce9c-0822-4c1d-a9f3-78537657155b&rdquo;]
}
#+END_QUERY</p><ul><li><p><strong>Query backlog TODO and DOING tasks</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/868476460061577227>Discord</a>
date:: 2021-07-24</p><ul><li><p>#+BEGIN_QUERY
{:title &ldquo;Backlog&rdquo;
:query [:find (pull ?todo [*]) :in $ ?current-page
:where
[?p :block/name ?current-page]
[?todo :block/marker ?marker]
(not [?todo :block/page ?p])
(not [_ :block/refs ?todo])
[(contains? #{&ldquo;TODO&rdquo; &ldquo;DOING&rdquo;} ?marker)]
]
:inputs [:current-page]
:breadcrumb-show? false
:result-transform (fn [result]</p><pre><code>              (sort-by (fn [h]
                         (get h :block/priority &quot;Z&quot;)) result))
</code></pre></li></ul></li></ul><p>:collapsed? true}
#+END_QUERY</p><ul><li><p><strong>Search for a keyword within a specific set of pages</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/868531920923918356>Discord</a>, <a href=https://discord.com/channels/725182569297215569/743139225746145311/868600535694082049>Discord</a>
date:: 2021-07-24</p><ul><li><p>#+BEGIN_QUERY
{:title &ldquo;Siloed search&rdquo;
:query [:find (pull ?b [*])</p><p>:in $ ?keyword [?title &mldr;]
:where
[?p :block/original-name ?title]
[?b :block/page ?p]
[?b :block/content ?c]
[(clojure.string/includes? ?c ?keyword)]]</p></li></ul></li></ul><p>:inputs [&ldquo;tasks&rdquo; [&ldquo;Advanced queries&rdquo; &ldquo;Advanced queries/Examples&rdquo;]]
}
#+END_QUERY</p><pre><code>+ #+BEGIN_QUERY
</code></pre><p>{:title &ldquo;Siloed search&rdquo;
:query [:find (pull ?b [*])</p><pre><code>     :in $ ?keyword [?title ...]
     :where
     [(str &quot;(?i)&quot; ?keyword) ?matcher]
     [(re-pattern ?matcher) ?regex]
     [?p :block/original-name ?title]
     [?b :block/page ?p]
     [?b :block/content ?c]
     [(re-find ?regex ?c)]]
</code></pre><p>:inputs [&ldquo;tasks&rdquo; [&ldquo;Advanced queries&rdquo; &ldquo;Advanced queries/Examples&rdquo;]]
}
#+END_QUERY</p><ul><li><p><strong>Broken references</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/869291105911447653>Discord</a>
date:: 2021-07-26</p><ul><li><p>#+BEGIN_QUERY
{:title &ldquo;Broken References&rdquo;
:query [:find (pull ?b [*])</p><p>:in $ ?matcher
:where
[(re-pattern ?matcher) ?regex]
[?b :block/content ?c]
[(re-find ?regex ?c)]
[(missing? $ ?b :block/refs)]]</p></li></ul></li></ul><p>:inputs [ &ldquo;\([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\)&rdquo;]
}
#+END_QUERY</p><ul><li><p><strong>Current NOW and DOING tasks for pages tagged with &ldquo;project&rdquo;</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/879621160860532766>Discord</a>
date:: 2021-08-24</p><ul><li>#+BEGIN_QUERY
{:title &ldquo;?�� Project Now&rdquo;</li></ul><p>:query [:find (pull ?h [*])
:in $ ?searchterm
:where
[?h :block/marker ?marker]
[(contains? #{&ldquo;NOW&rdquo; &ldquo;DOING&rdquo;} ?marker)]
[?p :block/properties ?a]
[(get ?a :type) ?t]
[(= ?searchterm ?t)]
[?br :block/name ?searchterm]
(or [?h :block/page ?p]
[?h :block/refs ?br])
]
:inputs [&ldquo;project&rdquo;]
:result-transform (fn [result]
(sort-by (fn [h]
(get h :block/priority &ldquo;Z&rdquo;)) result))
:collapsed? false}</p></li></ul><p>#+END_QUERY</p><ul><li><p><strong>Querying TODOs from hierarchy pages</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/880431776500179004>Discord</a>
date:: 2021-08-06</p><ul><li><p>#+BEGIN_QUERY
{:query [:find (pull ?b [*])</p><p>:in $ ?s
:where
[?b :block/marker &ldquo;DONE&rdquo;]
[?b :block/page ?p]
[?p :block/original-name ?n]
[(clojure.string/starts-with? ?n ?s)]]</p></li></ul></li></ul><p>:inputs [ &ldquo;Advanced queries/&rdquo; ]
}
#+END_QUERY</p><pre><code>+ DONE Completed this query
</code></pre><ul><li><strong>List all the pages updated in the last 3 days</strong></li></ul><p>link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/884486589827395724>Discord</a>, <a href=https://discord.com/channels/725182569297215569/743139225746145311/885529176730398821>Discord</a>
date:: 2021-09-06, 2021-09-09</p><pre><code>+ The time entered in the Unix time stamp (see https://www.unixtimestamp.com) which is the number of milliseconds since Jan 1st 1970.
</code></pre><p>query-properties:: [:page :updated-at]</p><pre><code>+ We may have to multiply with 1000 to get the result in milliseconds, if using the above site.

+ query-sort-by:: updated-at
</code></pre><p>query-sort-desc:: true
query-properties:: [:page :updated-at]
#+BEGIN_QUERY
{:title [:h3 &ldquo;Updated in last 3 days&rdquo;]
:query [:find (pull ?b [*])
:in $ ?end
:where
[?b :block/updated-at ?v]
[(- ?end 259200000 ) ?period]
[(>= ?v ?period)]
[(&lt; ?v ?end)]
]
; :inputs [:start-of-today-ms]
; :inputs [:right-now-ms]
:inputs [:end-of-today-ms]
}
#+END_QUERY</p><ul><li><p><strong>Query for TODO and LATER but excluding SCHEDULED tasks</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/888689090160103476>Discord</a>
date:: 2021-09-18</p><ul><li>#+BEGIN_QUERY
{:query [:find (pull ?b [*])
:where
[?b :block/marker ?m]
[(contains? #{&ldquo;TODO&rdquo; &ldquo;LATER&rdquo;} ?m)]
[(missing? $ ?b :block/scheduled)]
[(missing? $ ?b :block/deadline)] ] }
#+END_QUERY</li></ul></li><li><p><strong>Query for a task having a given block property</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/889013656409505802>Discord</a>
date:: 2021-09-19</p><ul><li><p>#+BEGIN_QUERY
{:title &ldquo;My TASKS (type: example)&rdquo;
:query [:find (pull ?b [*])
:where
[?b :block/marker ?marker]
[(contains? #{&ldquo;DONE&rdquo;} ?marker)]
[?b :block/properties ?prop]
[(get ?prop :type) ?type]
[(= &ldquo;example&rdquo; ?type)]
]
:collapsed? false}
#+END_QUERY</p></li><li><p>DONE Check query with task and property.
type:: example</p></li></ul></li><li><p><strong>List all projects (type:: project) that do not have any TODOs on their pages</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/891274363062599702>Discord</a>
date:: 2021-09-25</p><ul><li>#+BEGIN_QUERY
{:query[:find (pull ?p [*])
:where
[?b :block/page ?p]
[?p :block/properties ?props]
[(get ?props :type) ?type]
[(= ?type &ldquo;project&rdquo;)]
(not-join [?p]</li></ul><p>[?b :block/page ?p]
[?b :block/marker _]) ]}</p></li></ul><p>#+END_QUERY</p><ul><li><strong>List all the projects with page property &ldquo;status&rdquo; as :Active</strong></li></ul><p>link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/891910125667905546>Discord</a>
date:: 2021-9-27</p><pre><code>+ #+BEGIN_QUERY
</code></pre><p>{:query[:find (pull ?p [*])
:where
[?b :block/page ?p]
[?p :block/properties ?props]
[(get ?props :status) ?status]
[(= ?status #{&ldquo;Active&rdquo;})]]}
#+END_QUERY</p><ul><li><strong>Query all tasks excluding those on a page Journal reviews]]</strong></li></ul><p>link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/892166421029728256>Discord</a>, <a href=https://discord.com/channels/725182569297215569/743139225746145311/892189369622990949>Discord</a>
date:: 2021-09-27</p><pre><code>+ #+BEGIN_QUERY
</code></pre><p>{:title &ldquo;?�� TESTING&rdquo;</p><pre><code>  :query [:find (pull ?b [*])
          :where
          [?b :block/marker ?marker]
          [(missing? $ ?b :block/scheduled)]
          [(missing? $ ?b :block/deadline)]
          [(contains? #{&quot;LATER&quot; &quot;TODO&quot;} ?marker)]
          [?b :block/page ?page]
          [?page :block/original-name ?name]
          (not[(= ?name &quot;Journal reviews&quot;)])]
</code></pre><p>}
#+END_QUERY</p><pre><code>+ #+BEGIN_QUERY
</code></pre><p>{:title &ldquo;Main Tasks&rdquo;</p><pre><code>  :query [:find (pull ?b [*])
          :where
          [?b :block/marker ?marker]
          [(missing? $ ?b :block/scheduled)]
          [(missing? $ ?b :block/deadline)]
          [(contains? #{&quot;LATER&quot; &quot;TODO&quot;} ?marker)]
          (not [?b :block/path-refs [:block/name &quot;test&quot;]])
          [?b :block/page ?page]
          [?page :block/original-name ?name]
          (not[(= ?name &quot;Journal reviews&quot;)])]
</code></pre><p>:breadcrumb-show? false
:result-transform (fn [result]</p><pre><code>                    (sort-by (fn [h]
                               (get h :block/created-at)) result))
</code></pre><p>:collapsed? true
}
#+END_QUERY</p><ul><li>DONE <strong>Query all scheduled/deadlined tasks and sort them by scheduled or deadline date</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/897615821688410114>Discord</a>
date:: 2021-10-13</li></ul><p>SCHEDULED: &lt;2022-01-30 Sun></p><pre><code>+ #+BEGIN_QUERY
</code></pre><p>{:title &ldquo;?�� Future Tasks&rdquo;
:query [:find (pull ?block [*])</p><pre><code>     :in $ ?start ?next
     :where
     [?block :block/marker ?marker]
     [(contains? #{&quot;NOW&quot; &quot;LATER&quot; &quot;TODO&quot; &quot;DOING&quot; &quot;WAITING&quot;} ?marker)]
     (or
       [?block :block/scheduled ?d]
       [?block :block/deadline ?d])
     [(&gt;= ?d ?start)]
     [(&lt;= ?d ?next)]]
</code></pre><p>:inputs [:today :365d-after]
:breadcrumb-show? false
:result-transform (fn [result]</p><pre><code>                 (sort-by (fn [b]
                           (or (get b :block/scheduled) (get b :block/deadline))) result))
</code></pre><p>:collapsed? true
}
#+END_QUERY</p><ul><li><p><strong>All tasks with priority A</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/898234502890004532>Discord</a>
date:: 2021-10-14</p><ul><li><p>#+BEGIN_QUERY
{:title &ldquo;All todos that with priority A&rdquo;
:query [:find (pull ?b [*])</p><p>:where
[?b :block/priority &ldquo;A&rdquo;]]}</p></li></ul></li></ul><p>#+END_QUERY</p><ul><li><p><strong>Query snippet to grab the children blocks</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/901520859779461170>Discord</a>
date:: 2021-10-23</p><ul><li>Replace <code>(pull ?h [*])</code> with:</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>pull</span> ?h [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:db/id</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/uuid</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/type</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/left</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/format</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/title</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/refs</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/_refs</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/path-refs</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/tags</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/content</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/marker</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/priority</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/properties</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/body</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/pre-block?</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/scheduled</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/deadline</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/repeated?</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/created-at</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/updated-at</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/file</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/parent</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/unordered</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:block/heading-level</span>
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>:block/page</span>
</span></span><span style=display:flex><span>    [<span style=color:#e6db74>:db/id</span> <span style=color:#e6db74>:block/name</span> <span style=color:#e6db74>:block/original-name</span> <span style=color:#e6db74>:block/journal-day</span>]}
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>:block/_parent</span> ...}])
</span></span></code></pre></div><ul><li><strong>Query for non-task blocks with a schedule/deadline in the past</strong></li></ul><p>link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/905889607705575434>Discord</a>
date:: 2021-11-04</p><pre><code>+ query-table:: false
</code></pre><p>#+BEGIN_QUERY
{:title &ldquo;Old Blocks&rdquo;
:query [:find (pull ?b [*])</p><pre><code>             :in $ ?start
             :where
             (or [?b :block/scheduled ?d]
                 [?b :block/deadline ?d])
             [(&lt; ?d ?start)]
             (not [?b :block/marker ?marker] 
              [(contains? #{&quot;DONE&quot; &quot;CANCELED&quot;} ?marker)])]
</code></pre><p>:inputs [:today]
:collapsed? false}
#+END_QUERY</p><ul><li><p><strong>Query to find tasks under a block containing the text &ldquo;Follow-up&rdquo;</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/918847233586253906>Discord</a>
date:: 2021-12-10</p><ul><li><p>Follow-up</p><ul><li><p>DONE find this block</p></li><li><p>#+BEGIN_QUERY
{:title &ldquo;Find: Follow-up Tasks&rdquo;
:query [:find (pull ?b [*])
:where</p></li></ul></li></ul><p>[?p :block/content &ldquo;Follow-up&rdquo;]
[?b :block/parent ?p]
[?b :block/marker ?marker]
[(contains? #{&ldquo;TODO&rdquo; &ldquo;DOING&rdquo; &ldquo;DONE&rdquo;} ?marker)]]</p></li></ul><p>}
#+END_QUERY</p><ul><li><p><strong>Query all pages that have been created in the last 2 days</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/920559641514082374>Discord</a>
date:: 2021-12-15</p><ul><li><p>query-properties:: [:page :created-at]
#+BEGIN_QUERY
{:title &ldquo;Pages in last 2 days&rdquo;
:query [:find (pull ?p [*])</p><pre><code>  :in $ ?today
  :where 
  [?p :block/created-at ?d]
  [(- ?today 172800000) ?start]
  [(&gt;= ?d ?start)]
  [(&lt;= ?d ?today)]
</code></pre></li></ul><p>]</p></li></ul><p>:inputs [:right-now-ms]}
#+END_QUERY</p><pre><code>+ `172800000` is 2 days in ms.
</code></pre><ul><li><p><strong>Query to create a table with page and todo count</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/921337299164356658>Discord</a>
date:: 2021-12-17</p><ul><li>query-table:: false
#+BEGIN_QUERY
{:title &ldquo;TODO by page&rdquo;
:query [:find (pull ?b [:block/marker :block/parent {:block/page</li></ul><p>[:db/id :block/name]}])</p></li></ul><p>:where</p><pre><code>       [?b :block/marker ?marker]
       [(= &quot;TODO&quot; ?marker)] 
</code></pre><p>]
:result-transform (fn [result]</p><pre><code>                    (map (fn key value {:page (get key :block/name) :count (count value)}) (group-by :block/page result))
            )
</code></pre><p>:view (fn [rows] [:table
[:thead
[:tr
[:th &ldquo;Page&rdquo;]
[:th &ldquo;Count&rdquo;] ] ]
[:tbody
(for [r rows] [:tr
[:td [:a {:href (str &ldquo;#/page/&rdquo; (get r :page))} (get r :page)] ]
[:td (get r :count)] ])
]]
)
}
#+END_QUERY</p><ul><li><p><strong>Simple query to finds all the tasks created today</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/923276145321967676>Discord</a>, <a href=https://discord.com/channels/725182569297215569/743139225746145311/923282510283169812>Discord</a>, <a href=https://discord.com/channels/725182569297215569/743139225746145311/923486975552528424>Discord</a>
date:: 2021-12-22</p><ul><li><p>{{query (and (between -0d ++0d) (task TODO))}}</p></li><li><p>d is used to indicate a day. 0d means 0 days or today.
Think of it this way:
Between -0d and ++0d</p><ul><li>= between today-1 and today+1
= between yesterday and tommrow
= today</li></ul></li><li><p>++1d transformed to todays date
+1d transformed to tomorrow
-1d transformed to yesterday</p></li></ul></li><li><p><strong>Query all blocks on the current page having a specific tag, say &ldquo;#datalog&rdquo;</strong>
link:: <a href=https://discord.com/channels/725182569297215569/743139225746145311/923925207738109962>Discord</a>
date:: 2021-12-24</p><ul><li>#+BEGIN_QUERY
{</li></ul><p>:query [
:find (pull ?b [*])
:in $ ?current-page
:where
[?p :block/name ?current-page]
[?b :block/page ?p]
[?b :block/path-refs [:block/name &ldquo;datalog&rdquo;]]
]
:inputs [:current-page]}</p></li></ul><p>}
#+END_QUERY</p><ul><li><strong>Query to create a table from &ldquo;birthday&rdquo; property of a page</strong><ul><li><p>query-table:: false
query-properties:: [:alias :birthday]
#+BEGIN_QUERY
{
:query [:find (pull ?b [*])</p><p>:where
[?b :block/properties ?bprops]
[(get ?bprops :birthday &ldquo;nil&rdquo;) ?bs]
[(not= ?bs &ldquo;nil&rdquo;)]]</p></li></ul></li></ul><p>:result-transform (fn [result]</p><pre><code>(sort-by (fn [h]
  (get-in h [:block/properties :verjaardag])) result))
</code></pre><p>}
#+END_QUERY</p></div><aside><h4>No notes link to this note</h4></aside><aside class=related></aside><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://charleschiugit.github.io>Charles Chiu</a></span><br><span>Powered by
<a href=https://github.com/sawhney17/logseq-schrodinger rel=noopener target=_blank>Logseq Schrödinger</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>