<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Logseq/Queries | Charles Chiu</title>
<meta name=keywords content><meta name=description content="from @Jeddychan in Logseq&rsquo;s discord #.v-border-children
Terms / Names - Datalog &mdash;&mdash; a query language used for databases Datascript &mdash; a flavor of Datalog written in Clojure. Logseq currently uses Datascript. Datomic &mdash;&ndash; a different flavor of Datalog written in Clojure. (Some tutorials for Datomic may be helpful, but ymmv) Hiccup &mdash;&mdash;- a language used to generate HTML, you can use it in an advanced query&rsquo;s custom view ( :view )"><meta name=author content="Charles Chiu"><link rel=canonical href=https://charleschiugit.github.io/page/logseq/queries/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://charleschiugit.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://charleschiugit.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://charleschiugit.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://charleschiugit.github.io/apple-touch-icon.png><link rel=mask-icon href=https://charleschiugit.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://charleschiugit.github.io/page/logseq/queries/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Logseq/Queries"><meta property="og:description" content="from @Jeddychan in Logseq&rsquo;s discord #.v-border-children
Terms / Names - Datalog &mdash;&mdash; a query language used for databases Datascript &mdash; a flavor of Datalog written in Clojure. Logseq currently uses Datascript. Datomic &mdash;&ndash; a different flavor of Datalog written in Clojure. (Some tutorials for Datomic may be helpful, but ymmv) Hiccup &mdash;&mdash;- a language used to generate HTML, you can use it in an advanced query&rsquo;s custom view ( :view )"><meta property="og:type" content="article"><meta property="og:url" content="https://charleschiugit.github.io/page/logseq/queries/"><meta property="article:section" content="page"><meta property="article:published_time" content="2022-04-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Logseq/Queries"><meta name=twitter:description content="from @Jeddychan in Logseq&rsquo;s discord #.v-border-children
Terms / Names - Datalog &mdash;&mdash; a query language used for databases Datascript &mdash; a flavor of Datalog written in Clojure. Logseq currently uses Datascript. Datomic &mdash;&ndash; a different flavor of Datalog written in Clojure. (Some tutorials for Datomic may be helpful, but ymmv) Hiccup &mdash;&mdash;- a language used to generate HTML, you can use it in an advanced query&rsquo;s custom view ( :view )"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Pages","item":"https://charleschiugit.github.io/page/"},{"@type":"ListItem","position":2,"name":"Logseq/Queries","item":"https://charleschiugit.github.io/page/logseq/queries/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Logseq/Queries","name":"Logseq\/Queries","description":"from @Jeddychan in Logseq\u0026rsquo;s discord #.v-border-children\nTerms / Names - Datalog \u0026mdash;\u0026mdash; a query language used for databases Datascript \u0026mdash; a flavor of Datalog written in Clojure. Logseq currently uses Datascript. Datomic \u0026mdash;\u0026ndash; a different flavor of Datalog written in Clojure. (Some tutorials for Datomic may be helpful, but ymmv) Hiccup \u0026mdash;\u0026mdash;- a language used to generate HTML, you can use it in an advanced query\u0026rsquo;s custom view ( :view )","keywords":[],"articleBody":"from @Jeddychan in Logseq’s discord #.v-border-children\nTerms / Names - Datalog —— a query language used for databases Datascript — a flavor of Datalog written in Clojure. Logseq currently uses Datascript. Datomic —– a different flavor of Datalog written in Clojure. (Some tutorials for Datomic may be helpful, but ymmv) Hiccup ——- a language used to generate HTML, you can use it in an advanced query’s custom view ( :view )\nOfficial Docs - https://logseq.github.io/#/page/queries https://logseq.github.io/#/page/advanced%20queries https://logseq.github.io/#/page/hiccup\nDatalog - http://www.learndatalogtoday.org/ http://www.learndatalogtoday.org/chapter/0 When reading through this, I realized that viewing some of the query keywords as relationships between objects, made everything make a lot more sense/intuitive\nDatascript - https://github.com/tonsky/datascript/wiki/Getting-started https://github.com/tonsky/datascript#resources\nDatomic - https://docs.datomic.com/on-prem/query/query.html#syntax-used-in-grammar Only some info here may be applicable, but I found the syntax section to be helpful in understanding the meaning of all the brackets used in queries (like: [ ], { }, ( ), etc.)\nLogseq’s Database Schema - https://github.com/logseq/logseq/blob/master/src/main/frontend/db_schema.cljs Here you can see how the database is structured and all the keywords (you may recognize some keywords from example queries)\nHiccup Syntax - https://github.com/weavejester/hiccup/wiki/Syntax\nUnofficial Docs - https://mschmidtkorth.github.io/logseq-msk-docs/#/page/queries\nfrom @Bad3r in Logseq’s discord #.v-border-children\nDatalog is what’s called a rule based query language. It’s been around since the 80s Some resources for learning Datalog.\nhttp://www.learndatalogtoday.org/\nhttps://nextjournal.com/try/learn-crux-datalog-today/learn-crux-datalog-today\nhttps://docs.datomic.com/query.html\nLogseq queries\nhttps://mschmidtkorth.github.io/logseq-msk-docs/#/page/Queries%2FAdvanced%20Queries%2FTutorial\nhttps://docs.logseq.com/#/page/advanced%20queries\nfrom @Avijeet in Logseq’s discord #.v-border-children\nHi, I have compiled a list of advanced queries and references from this channel, which I was able to execute for my database (still need to add those from the last few weeks). Thought it might be useful to those looking for advanced queries examples. Link to the original discord message and dates are also included for context 🙂.\n[[Logseq/Advanced_queries_Examples]]\nfrom @cldwalker in Logseq’s discord #.v-border-children\nThere is a handy new query feature in the nightly build - the ability to use any of these simple query rules, https://github.com/logseq/logseq/blob/2e340ca1c6d73731275d526c09e94d8d9e44214e/src/main/frontend/db/rules.cljc#L61-L141,\nin an advanced query. Here is an example query - https://github.com/logseq/logseq/blob/ed6a02c6921f6605d6c2482ca013f81de9c16b01/src/test/frontend/db/query_custom_test.cljs#L26-L29 .\nWhile the rules have the same names as the operators in simple queries, their arguments can be different. Examples of their arguments are at https://gist.github.com/logseq-cldwalker/796202d55897fd34ea3d8c3bb3401ae0\n:keys logic for query: https://github.com/tonsky/datascript/blob/master/docs/queries.md#return-maps\nGet all block’s uuid\n#+BEGIN_QUERY {:title \"tmp\" :view (fn [result] (for [r result] [:pre (pr-str r)])) :query [:find (pull ?b [*]) :where [?b :block/uuid _]]} :view (fn [result] (for [r result] [:pre (pr-str r)])) #+END_QUERY Example correction 6. All pages have a \"programming\" tag in Advanced Queries\n#+BEGIN_QUERY {:title \"All pages have a *programming* tag\" :query [:find ?name :in $ ?tag :where [?t :block/name ?tag] [?p :page/tags ?t] [?p :block/name ?name]] :inputs [\"programming\"] :view (fn [result] [:div.flex.flex-col (for [page result] [:a {:href (str \"#/page/\" page)} (clojure.string/capitalize page)])])} #+END_QUERY Query multiple tags\n#+BEGIN_QUERY {:title [:h2 \"Commitments\"] :query [:find (pull ?b [*]) :in $ ?start ?today ?tag :where [?b :block/page ?p] [?p :page/journal-day ?d] [(\u003e= ?d ?start)] [(\u003c= ?d ?today)] [?b :block/ref-pages ?ref] (or [?ref :block/name ?tag] [?ref :block/name \"othertag\"]) ] :inputs [:7d-before :today \"TAG1\"]} #+END_QUERY Sorting based on a block property\n- query-table:: false query-properties:: [:alias :birthday] #+BEGIN_QUERY { :query [:find (pull ?b [*]) :where [?b :block/properties ?bprops] [(get ?bprops :birthday \"nil\") ?bs] [(not= ?bs \"nil\")]] :result-transform (fn [result] (sort-by (fn [h] (get-in h [:block/properties :verjaardag])) result)) } #+END_QUERY Display today page through query dynamically based on today’s date\n#+BEGIN_QUERY {:title \"Scheduled items\" :query [:find (pull ?b [*]) :in $ ?today :where [?b :block/scheduled] [(get-else $ ?b :block/priority \"NIL\") ?prio] [(get-else $ ?b :block/marker \"NIL\") ?marker] [(not= ?marker \"DONE\")] [(not= ?marker \"CANCELED\")] [(not= ?marker \"LATER\")] [(get-else $ ?b :block/scheduled ?today) ?d] [(\u003e= ?d ?today)] ] :inputs [:today] :breadcrumb-show? false :result-transform (fn [result] (sort-by (fn [h] (get h :block/priority \"Z\") ) result)) :collapsed? false } #+END_QUERY Capture all the quotes\nLogseq has two ways you can write quotes, you only match one, this should do the trick: #+BEGIN_QUERY {:title \"QUOTE search\" :query [:find (pull ?b [*]) :where [?b :block/content ?c] (or [(clojure.string/includes? ?c \"#+BEGIN_QUOTE\")] [(clojure.string/starts-with? ?c \"\u003e \")] )]} #+END_QUERY Query for all the blocks which have a block property = current page, use the name of current page dynamically instead of fixing it on each page\nthe page name have to be lowercase. #+BEGIN_QUERY {:query [ :find (pull ?b [*]) :in $ ?current-page :where [?p :block/name ?current-page] [?b :block/page ?p] [?b :block/path-refs [:block/name \"datalog\"]] ] :inputs [:current-page]} } #+END_QUERY you can use :block/name or :block/original-name to differentiate, but the first is always lowercase (afaik), so it’s not a good habit (on Logseq) to depend on differences in case. #+BEGIN_QUERY {:query [:find (pull ?e [*]) :in $ ?current-page :where [?b :block/marker ?marker] [(contains? #{\"TODO\" \"LATER\" \"NOW\" \"DOING\"} ?marker)] [?e :block/properties ?prop] [(get ?prop :projects) ?value] [(contains? ?value ?current-page)] ] :inputs [:current-page] :result-transform (fn [result] (sort-by (fn [h] (get h :block/priority \"Z\")) result)) :collapsed? false}} #+END_QUERY Workaround find block which are highlighted with ==\nsol. 1 #+BEGIN_QUERY {:title \"Highlight search\" :query [:find (pull ?b [*]) :where [?b :block/content ?c] [(clojure.string/includes? ?c \"==\")] ]} #+END_QUERY sol. 2 #+BEGIN_QUERY {:title \"Highlight search\" :query [:find (pull ?b [*]) :where [?b :block/content ?c] [(re-pattern \" .* \") ?regex] [(re-find ?regex ?c)] ]} #+END_QUERY Show scheduled or deadline only on today’s journal\n#+BEGIN_QUERY {:title \"SCHEDULED OR DEADLINE\" :query [ :find (pull ?b [*]) :in $ ?current-page :where [?p :block/name ?current-page] [?p :block/journal? true] [?p :block/journal-day ?date] (or [?b :block/scheduled ?date] [?b :block/deadline ?date] ) (not [?b :block/marker]) ] :inputs [:current-page]} #+END_QUERY Query the block \u0026 page title of certain pages or tags\n#+BEGIN_QUERY {:title \"Query for page references \u0026 tags.\" :query [:find (pull ?b [*]) :in $ ?page_name :where [?b :block/refs ?r] [?r :block/name ?page_name]] :inputs [\"mar 28, 2022\"]} #+END_QUERY Always query for current date / today\nDiscord Link\n{{query \u003c%today%\u003e}}\nConcatenate all the journal entries of the week in the Friday entry.\nDiscord Link #+BEGIN_QUERY {:title \"What has been done\" :query [:find (pull ?b [*]) :in $ ?current-page ?start ?today :where [?b :block/page ?p] [?p :page/journal? true] [?p :page/journal-day ?d] ;[?p :block/name ?current-page] ;[?p :block/journal-day ?current-page-day] [(\u003e= ?d ?start)] (or [(\u003c= ?d ?current-page)] [(\u003c= ?d ?today)]) ] :inputs [:current-page :7d-before :today]} #+END_QUERY As I’m using NOW/LATER + WAITING approach, my common workflow for tasks life cycle is:\nadd something not urgent (and visually “muted”) with WAITING without date add common task with LATER + plan it if needed with deadline\\scheduled add current\\urgent task with NOW –\u003e work on it –\u003e finish with DONE take overdued tasks take some LATER task –\u003e delete planed date if it was –\u003e set it to NOW –\u003e work –\u003e finish with DONE I was trying to mix 2 layers of tasks planning as you can see - task status cycle and “calendared” items:\n“what is overdued?”\n“what should I do today?”\n“what should I do tomorrow?”\n“what can I do next?”\n“what is WAITING?”\nPS: no sorting in queries, as i want to see parent pages links 😒 #.v-gallery-h400-fit ✅ wanna have block answering my question “what is overdued?” anything task calendared before today also as this block can called “attention” - I’m searching for “wrong” tasks calendared NOW(it should no have date, as described before) #+BEGIN_QUERY { :title [[:strong \"🔥 Overdue\"] [:span \" or \"] [:span.block-marker.NOW \"NOW\"] [:sup \"(with-date)\"]] :query [ :find (pull ?block [*]) :in $ ?start ?next :where [?block :block/marker ?m] (or-join [?block ?start ?next ?m] (and (or [?block :block/scheduled ?d] [?block :block/deadline ?d]) [(\u003e ?d ?start)] [(\u003c ?d ?next)] ) ;; (and [(contains? #{\"NOW\"} ?m)] (or [?block :block/scheduled ?d] [?block :block/deadline ?d]) ) ) ] :inputs [:365d-before :today] :breadcrumb-show? false :collapsed? false } #+END_QUERY ✅ wanna have block answering my question “what should i do today?” not calendared status NOW = today status LATER with date today #+BEGIN_QUERY { :title [[:strong \"⏰ Today\"] [:span \" or \"] [:span.block-marker.NOW \"NOW\"]] :query [ :find (pull ?block [*]) :in $ ?day :where [?block :block/marker ?m] (or-join [?block ?day ?m] (and [(contains? #{\"LATER\"} ?m)] (or [?block :block/scheduled ?d] [?block :block/deadline ?d]) [(= ?d ?day)] ) ;; (and [(contains? #{\"NOW\"} ?m)] [(missing? $ ?block :block/scheduled)] [(missing? $ ?block :block/deadline)] ) ) ] :inputs [:today] :breadcrumb-show? false :collapsed? false } #+END_QUERY ✅ wanna have block answering my question “what should i do tomorrow?” LATER with date tomorrow #+BEGIN_QUERY { :title [:strong \"🌞 Tomorrow\"] :query [ :find (pull ?block [*]) :in $ ?day :where [?block :block/marker ?m] [(contains? #{\"LATER\"} ?m)] (or [?block :block/scheduled ?d] [?block :block/deadline ?d]) [(= ?d ?day)] ] :inputs [:1d-after] :breadcrumb-show? false :collapsed? false } #+END_QUERY ✅ wanna have block answering my question “what can i do next?” not calendared with status LATER = next any status with date after tomorrow = next #+BEGIN_QUERY { :title [[:strong \"📅 This week\"] [:span \" or \"] [:span.block-marker.LATER \"LATER\"] [:sup \"(without-date)\"]] :query [ :find (pull ?block [*]) :in $ ?start ?next :where (or-join [?block ?start ?next] (and (or [?block :block/scheduled ?d] [?block :block/deadline ?d]) [(\u003e ?d ?start)] [(\u003c ?d ?next)] ) ;; (and [?block :block/marker ?m] [(contains? #{\"LATER\"} ?m)] [(missing? $ ?block :block/scheduled)] [(missing? $ ?block :block/deadline)] ) ) ] :inputs [:1d-after :7d-after] :breadcrumb-show? false :collapsed? false } #+END_QUERY ✅ wanna have block answering my question “what is WAITING?” (collapsed, to not blow my eyes) not calendared with status WAITING #+BEGIN_QUERY { :title [:strong \"⏳ Waiting\"] :query [ :find (pull ?block [*]) :where [?block :block/marker ?marker] [(contains? #{\"WAITING\"} ?marker)] ] :breadcrumb-show? false :collapsed? true } #+END_QUERY Add HTML markup to query title\nDiscord Link\nDiscord Link\nhiccup wiki\nhiccup-samples\npage for pdf files has property :file and :file-path:\nDiscord Link #+BEGIN_QUERY { :query [:find (pull ?p [*]) :where [has-page-property ?p :file] ] } #+END_QUERY Find all unlinked pages/orphaned nodes\nDiscord Link #+BEGIN_QUERY {:title \"orphan pages\" :query [:find ?name :where [?p :page/name ?name] (not [?b :block/ref-pages ?p1] [?b :block/page ?p2] (or [?p1 :page/name ?name] [?p2 :page/name ?name]))] :view (fn [result] [:div.flex.flex-col (for [page result] [:a {:href (str \"#/page/\" page)} (clojure.string/capitalize page)])])} #+END_QUERY Use query in a template.\nDiscord Link #+BEGIN_QUERY {:title [:b \"\u003c%current page%\u003e\"] :query [:find (pull ?b [*]) :in $ ?current-page :where [?b :block/path-refs ?name] [?name :block/name ?current-page] ] :inputs [:current-page] :breadcrumb-show? false } #+END_QUERY Query for icon page property.\nDiscord Link #+BEGIN_QUERY {:title \"\" :query [:find (pull ?p [*]) :where [?p :block/properties ?prop] [(get ?prop :icon) ?icon] ; [(= \"example\" ?type)]` ]} #+END_QUERY Get scheduled tasks within a namespace.\nDiscord Link #+BEGIN_QUERY {:title \" Scheduled dates in Golf namespace\" :query [:find (pull ?b [*]) :where [?b :block/scheduled ?d] [?b :block/marker ?marker] [?b :block/page ?p] [?p :block/namespace ?ns] [?ns :block/name ?nsn] [(contains? #{\"golf\"} ?nsn)]] :collapsed? false} #+END_QUERY :block/namespace are page property and :block/name are lowercase version of :block/original-name(page-name) Filter the page with time/timestamp.\nDiscord Link\nOzark/S04/Part 1\ntitle:: Ozark/S04/Part 1 status:: #towatch type:: series genre:: Crime, Drama, Thriller tags:: Netflix release_timestamp:: 1642723200000 release_smushed:: 20220121 Ozark/S04/Part 2 title:: Ozark/S04/Part 2 status:: #towatch type:: series genre:: Crime, Drama, Thriller tags:: Netflix release_timestamp:: 1651190400000 release_smushed:: 20220429 Query for timestamp #+BEGIN_QUERY {:title \"Unreleased Shows\" :query [:find (pull ?p [*]) :in $ ?today :where (page-property ?p :type \"series\") (page-property ?p :status \"towatch\") [?p :block/properties ?props] [(get ?props :release-timestamp) ?d] [(\u003e ?d ?today)] ] :inputs [:right-now-ms] } #+END_QUERY Query for yyyyMMdd #+BEGIN_QUERY {:title \"Unreleased Shows\" :query [:find (pull ?p [*]) :in $ ?today :where (page-property ?p :type \"series\") (page-property ?p :status \"towatch\") [?p :block/properties ?props] [(get ?props :release-smushed) ?d] [(\u003e ?d ?today)] ] :inputs [:today] } #+END_QUERY + Using journal-date format in page property and query it.\nDiscord Link\nDiscord Link\njust tested it with different journal-date format. replace [?p :block/name ?n] with [?p :block/original-name ?n]. date value are stored in property with original-name.\n#+BEGIN_QUERY {:title [\"Unreleased Shows\"] :query [:find (pull ?p2 [*]) :in $ ?today :where [?p2 :block/name _] [?p2 :block/properties ?prop] [(get ?prop :release) ?rel] [?p :block/original-name ?n] [(contains? ?rel ?n)] [?p :block/journal-day ?d] [(\u003e ?d ?today)] [(get ?prop :type) ?type] [(contains? #{\"series\"} ?type)] [(get ?prop :status) ?status] [(= #{\"towatch\"} ?status)]] :inputs [:today]} #+END_QUERY Have a property field that I only fill with numbers (floats). Is it possible to pull blocks where this field is within a range (say 20 \u003c x \u003c 50, or just x \u003e 100).\nDiscord Link #+BEGIN_QUERY { :query [:find (pull ?b [*]) :where [?b :block/properties ?prop] [(get ?prop :num-prop) ?num] [(\u003e ?num 100)] ] } #+END_QUERY for 20","wordCount":"2097","inLanguage":"en","datePublished":"2022-04-08T00:00:00Z","dateModified":"2022-04-21T00:00:00Z","author":{"@type":"Person","name":"Charles Chiu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://charleschiugit.github.io/page/logseq/queries/"},"publisher":{"@type":"Organization","name":"Charles Chiu","logo":{"@type":"ImageObject","url":"https://charleschiugit.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://charleschiugit.github.io/ accesskey=h title="Charles Chiu (Alt + H)">Charles Chiu</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://charleschiugit.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://charleschiugit.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://charleschiugit.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://charleschiugit.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Logseq/Queries</h1><div class=post-meta><span title='2022-04-08 00:00:00 +0000 UTC'>April 8, 2022</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Charles Chiu</div></header><div class=post-content><p>from @Jeddychan in Logseq&rsquo;s discord #.v-border-children</p><ul><li><p>Terms / Names -<br>Datalog &mdash;&mdash; a query language used for databases
Datascript &mdash; a flavor of Datalog written in Clojure. Logseq currently uses Datascript.
Datomic &mdash;&ndash; a different flavor of Datalog written in Clojure. (Some tutorials for Datomic may be helpful, but ymmv)
Hiccup &mdash;&mdash;- a language used to generate HTML, you can use it in an advanced query&rsquo;s custom view ( :view )</p></li><li><p>Official Docs -<br><a href=https://logseq.github.io/#/page/queries>https://logseq.github.io/#/page/queries</a>
<a href=https://logseq.github.io/#/page/advanced%20queries>https://logseq.github.io/#/page/advanced%20queries</a>
<a href=https://logseq.github.io/#/page/hiccup>https://logseq.github.io/#/page/hiccup</a></p></li><li><p>Datalog -<br><a href=http://www.learndatalogtoday.org/>http://www.learndatalogtoday.org/</a>
<a href=http://www.learndatalogtoday.org/chapter/0>http://www.learndatalogtoday.org/chapter/0</a>
When reading through this, I realized that viewing some of the query keywords as relationships between objects, made everything make a lot more sense/intuitive</p></li><li><p>Datascript -<br><a href=https://github.com/tonsky/datascript/wiki/Getting-started>https://github.com/tonsky/datascript/wiki/Getting-started</a>
<a href=https://github.com/tonsky/datascript#resources>https://github.com/tonsky/datascript#resources</a></p></li><li><p>Datomic -<br><a href=https://docs.datomic.com/on-prem/query/query.html#syntax-used-in-grammar>https://docs.datomic.com/on-prem/query/query.html#syntax-used-in-grammar</a>
Only some info here may be applicable, but I found the syntax section to be helpful in understanding the meaning of all the brackets used in queries (like: [ ], { }, ( ), etc.)</p></li><li><p>Logseq&rsquo;s Database Schema -<br><a href=https://github.com/logseq/logseq/blob/master/src/main/frontend/db_schema.cljs>https://github.com/logseq/logseq/blob/master/src/main/frontend/db_schema.cljs</a>
Here you can see how the database is structured and all the keywords (you may recognize some keywords from example queries)</p></li><li><p>Hiccup Syntax -<br><a href=https://github.com/weavejester/hiccup/wiki/Syntax>https://github.com/weavejester/hiccup/wiki/Syntax</a></p></li><li><p>Unofficial Docs -<br><a href=https://mschmidtkorth.github.io/logseq-msk-docs/#/page/queries>https://mschmidtkorth.github.io/logseq-msk-docs/#/page/queries</a></p></li></ul><p>from @Bad3r in Logseq&rsquo;s discord #.v-border-children</p><ul><li><p>Datalog is what&rsquo;s called a rule based query language. It&rsquo;s been around since the 80s
Some resources for learning Datalog.</p></li><li><p><a href=http://www.learndatalogtoday.org/>http://www.learndatalogtoday.org/</a></p></li><li><p><a href=https://nextjournal.com/try/learn-crux-datalog-today/learn-crux-datalog-today>https://nextjournal.com/try/learn-crux-datalog-today/learn-crux-datalog-today</a></p></li><li><p><a href=https://docs.datomic.com/query.html>https://docs.datomic.com/query.html</a></p></li></ul><p>Logseq queries</p><ul><li><p><a href=https://mschmidtkorth.github.io/logseq-msk-docs/#/page/Queries%2FAdvanced%20Queries%2FTutorial>https://mschmidtkorth.github.io/logseq-msk-docs/#/page/Queries%2FAdvanced%20Queries%2FTutorial</a></p></li><li><p><a href=https://docs.logseq.com/#/page/advanced%20queries>https://docs.logseq.com/#/page/advanced%20queries</a></p></li></ul><p>from @Avijeet in Logseq&rsquo;s discord #.v-border-children</p><ul><li><p>Hi, I have compiled a list of advanced queries and references from this channel, which I was able to execute for my database (still need to add those from the last few weeks). Thought it might be useful to those looking for advanced queries examples. Link to the original discord message and dates are also included for context 🙂.</p></li><li><p>[[Logseq/Advanced_queries_Examples]]</p></li></ul><p>from @cldwalker in Logseq&rsquo;s discord #.v-border-children</p><ul><li><p>There is a handy new query feature in the nightly build - the ability to use any of these simple query rules, <a href=https://github.com/logseq/logseq/blob/2e340ca1c6d73731275d526c09e94d8d9e44214e/src/main/frontend/db/rules.cljc#L61-L141>https://github.com/logseq/logseq/blob/2e340ca1c6d73731275d526c09e94d8d9e44214e/src/main/frontend/db/rules.cljc#L61-L141</a>,</p></li><li><p>in an advanced query. Here is an example query - <a href=https://github.com/logseq/logseq/blob/ed6a02c6921f6605d6c2482ca013f81de9c16b01/src/test/frontend/db/query_custom_test.cljs#L26-L29>https://github.com/logseq/logseq/blob/ed6a02c6921f6605d6c2482ca013f81de9c16b01/src/test/frontend/db/query_custom_test.cljs#L26-L29</a> .</p></li><li><p>While the rules have the same names as the operators in simple queries, their arguments can be different. Examples of their arguments are at <a href=https://gist.github.com/logseq-cldwalker/796202d55897fd34ea3d8c3bb3401ae0>https://gist.github.com/logseq-cldwalker/796202d55897fd34ea3d8c3bb3401ae0</a></p></li><li><p><code>:keys</code> logic for query:
<a href=https://github.com/tonsky/datascript/blob/master/docs/queries.md#return-maps>https://github.com/tonsky/datascript/blob/master/docs/queries.md#return-maps</a></p></li></ul><p>Get all block&rsquo;s uuid</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Clojure data-lang=Clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;tmp&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:view</span> (<span style=color:#66d9ef>fn </span>[result] (for [r result] [<span style=color:#e6db74>:pre</span> (pr-str r)]))
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>       [?b <span style=color:#e6db74>:block/uuid</span> _]]}
</span></span><span style=display:flex><span> <span style=color:#e6db74>:view</span> (<span style=color:#66d9ef>fn </span>[result] (for [r result] [<span style=color:#e6db74>:pre</span> (pr-str r)]))
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Example correction <code>6. All pages have a "programming" tag</code> in <a href=https://docs.logseq.com/#/page/advanced%20queries>Advanced Queries</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;All pages have a *programming* tag&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> ?name
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:in</span> $ ?tag
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>       [?t <span style=color:#e6db74>:block/name</span> ?tag]
</span></span><span style=display:flex><span>       [?p <span style=color:#e6db74>:page/tags</span> ?t]
</span></span><span style=display:flex><span>       [?p <span style=color:#e6db74>:block/name</span> ?name]]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>&#34;programming&#34;</span>]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:view</span> (<span style=color:#66d9ef>fn </span>[result]
</span></span><span style=display:flex><span>       [<span style=color:#e6db74>:div.flex.flex-col</span>
</span></span><span style=display:flex><span>        (for [page result]
</span></span><span style=display:flex><span>          [<span style=color:#e6db74>:a</span> {<span style=color:#e6db74>:href</span> (str <span style=color:#e6db74>&#34;#/page/&#34;</span> page)} (<span style=color:#a6e22e>clojure.string/capitalize</span> page)])])}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Query multiple tags</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> [<span style=color:#e6db74>:h2</span> <span style=color:#e6db74>&#34;Commitments&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:in</span> $ ?start ?today ?tag
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>       [?b <span style=color:#e6db74>:block/page</span> ?p]
</span></span><span style=display:flex><span>       [?p <span style=color:#e6db74>:page/journal-day</span> ?d]
</span></span><span style=display:flex><span>       [(&gt;= ?d ?start)]
</span></span><span style=display:flex><span>       [(&lt;= ?d ?today)]
</span></span><span style=display:flex><span>       [?b <span style=color:#e6db74>:block/ref-pages</span> ?ref]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       (or [?ref <span style=color:#e6db74>:block/name</span> ?tag]
</span></span><span style=display:flex><span>           [?ref <span style=color:#e6db74>:block/name</span> <span style=color:#e6db74>&#34;othertag&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       ]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:7d-before</span> <span style=color:#e6db74>:today</span> <span style=color:#e6db74>&#34;TAG1&#34;</span>]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Sorting based on a block property</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>    - query-table<span style=color:#960050;background-color:#1e0010>::</span> false
</span></span><span style=display:flex><span>      query-properties<span style=color:#960050;background-color:#1e0010>::</span> [<span style=color:#e6db74>:alias</span> <span style=color:#e6db74>:birthday</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>            <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>            [?b <span style=color:#e6db74>:block/properties</span> ?bprops]
</span></span><span style=display:flex><span>            [(get ?bprops <span style=color:#e6db74>:birthday</span> <span style=color:#e6db74>&#34;nil&#34;</span>) ?bs]
</span></span><span style=display:flex><span>            [(not= ?bs <span style=color:#e6db74>&#34;nil&#34;</span>)]]
</span></span><span style=display:flex><span>      <span style=color:#e6db74>:result-transform</span> (<span style=color:#66d9ef>fn </span>[result]
</span></span><span style=display:flex><span>          (sort-by (<span style=color:#66d9ef>fn </span>[h]
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>get-in</span> h [<span style=color:#e6db74>:block/properties</span> <span style=color:#e6db74>:verjaardag</span>])) result))
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Display today page through query dynamically based on today&rsquo;s date</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;Scheduled items&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:in</span> $ ?today 
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>            [?b <span style=color:#e6db74>:block/scheduled</span>]
</span></span><span style=display:flex><span>            [(<span style=color:#a6e22e>get-else</span> $ ?b <span style=color:#e6db74>:block/priority</span> <span style=color:#e6db74>&#34;NIL&#34;</span>) ?prio]
</span></span><span style=display:flex><span>            [(<span style=color:#a6e22e>get-else</span> $ ?b <span style=color:#e6db74>:block/marker</span> <span style=color:#e6db74>&#34;NIL&#34;</span>) ?marker]
</span></span><span style=display:flex><span>            [(not= ?marker <span style=color:#e6db74>&#34;DONE&#34;</span>)]
</span></span><span style=display:flex><span>            [(not= ?marker <span style=color:#e6db74>&#34;CANCELED&#34;</span>)]
</span></span><span style=display:flex><span>               [(not= ?marker <span style=color:#e6db74>&#34;LATER&#34;</span>)]
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>               [(<span style=color:#a6e22e>get-else</span> $ ?b <span style=color:#e6db74>:block/scheduled</span> ?today) ?d]
</span></span><span style=display:flex><span>            [(&gt;= ?d ?today)]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:today</span>]
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:breadcrumb-show?</span> false
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:result-transform</span> (<span style=color:#66d9ef>fn </span>[result]
</span></span><span style=display:flex><span>            (sort-by (<span style=color:#66d9ef>fn </span>[h]
</span></span><span style=display:flex><span>            (get h <span style=color:#e6db74>:block/priority</span> <span style=color:#e6db74>&#34;Z&#34;</span>)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>             result))
</span></span><span style=display:flex><span>          <span style=color:#e6db74>:collapsed?</span> false
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Capture all the quotes</p><ul><li>Logseq has two ways you can write quotes, you only match one, this should do the trick:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span> {<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;QUOTE search&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>   [?b <span style=color:#e6db74>:block/content</span> ?c]
</span></span><span style=display:flex><span>   (or [(<span style=color:#a6e22e>clojure.string/includes?</span> ?c <span style=color:#e6db74>&#34;#+BEGIN_QUOTE&#34;</span>)]
</span></span><span style=display:flex><span>       [(<span style=color:#a6e22e>clojure.string/starts-with?</span> ?c <span style=color:#e6db74>&#34;&gt; &#34;</span>)]
</span></span><span style=display:flex><span>   )]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Query for all the blocks which have a block property = current page, use the name of current page dynamically instead of fixing it on each page</p><ul><li>the page name have to be <code>lowercase</code>.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:query</span> [
</span></span><span style=display:flex><span> <span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*]) 
</span></span><span style=display:flex><span> <span style=color:#e6db74>:in</span> $ ?current-page
</span></span><span style=display:flex><span> <span style=color:#e6db74>:where</span> 
</span></span><span style=display:flex><span>  [?p <span style=color:#e6db74>:block/name</span> ?current-page]
</span></span><span style=display:flex><span>  [?b <span style=color:#e6db74>:block/page</span> ?p]
</span></span><span style=display:flex><span>  [?b <span style=color:#e6db74>:block/path-refs</span> [<span style=color:#e6db74>:block/name</span> <span style=color:#e6db74>&#34;datalog&#34;</span>]]
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:current-page</span>]}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li>you can use <code>:block/name</code> or <code>:block/original-name</code> to differentiate, but the first is always lowercase (afaik), so it&rsquo;s not a good habit (on Logseq) to depend on differences in case.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?e [*])
</span></span><span style=display:flex><span><span style=color:#e6db74>:in</span> $ ?current-page
</span></span><span style=display:flex><span><span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>[?b <span style=color:#e6db74>:block/marker</span> ?marker]
</span></span><span style=display:flex><span>[(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;TODO&#34;</span> <span style=color:#e6db74>&#34;LATER&#34;</span> <span style=color:#e6db74>&#34;NOW&#34;</span> <span style=color:#e6db74>&#34;DOING&#34;</span>} ?marker)]
</span></span><span style=display:flex><span>[?e <span style=color:#e6db74>:block/properties</span> ?prop]
</span></span><span style=display:flex><span>[(get ?prop <span style=color:#e6db74>:projects</span>) ?value]
</span></span><span style=display:flex><span>[(contains? ?value ?current-page)]
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span><span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:current-page</span>]
</span></span><span style=display:flex><span><span style=color:#e6db74>:result-transform</span> (<span style=color:#66d9ef>fn </span>[result]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (sort-by (<span style=color:#66d9ef>fn </span>[h]
</span></span><span style=display:flex><span>      (get h <span style=color:#e6db74>:block/priority</span> <span style=color:#e6db74>&#34;Z&#34;</span>)) result))
</span></span><span style=display:flex><span><span style=color:#e6db74>:collapsed?</span> false}}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li><a href=https://github.com/logseq/logseq/issues/4206#issuecomment-1038279559>Workaround</a></li></ul><hr><p>find block which are highlighted with ==</p><ul><li>sol. 1</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span> {<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;Highlight search&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>   [?b <span style=color:#e6db74>:block/content</span> ?c]
</span></span><span style=display:flex><span>   [(<span style=color:#a6e22e>clojure.string/includes?</span> ?c <span style=color:#e6db74>&#34;==&#34;</span>)]
</span></span><span style=display:flex><span>   ]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li>sol. 2</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span> {<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;Highlight search&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>   [?b <span style=color:#e6db74>:block/content</span> ?c]
</span></span><span style=display:flex><span>   [(re-pattern <span style=color:#e6db74>&#34;<mark>
    .*
</mark>&#34;</span>) ?regex]
</span></span><span style=display:flex><span>   [(re-find ?regex ?c)]
</span></span><span style=display:flex><span>   ]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Show scheduled or deadline only on today&rsquo;s journal</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;SCHEDULED OR DEADLINE&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:in</span> $ ?current-page
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>  [?p <span style=color:#e6db74>:block/name</span> ?current-page]
</span></span><span style=display:flex><span>  [?p <span style=color:#e6db74>:block/journal?</span> true]
</span></span><span style=display:flex><span>  [?p <span style=color:#e6db74>:block/journal-day</span> ?date]
</span></span><span style=display:flex><span>  (or 
</span></span><span style=display:flex><span>   [?b <span style=color:#e6db74>:block/scheduled</span> ?date]
</span></span><span style=display:flex><span>   [?b <span style=color:#e6db74>:block/deadline</span> ?date]
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>  (not [?b <span style=color:#e6db74>:block/marker</span>])
</span></span><span style=display:flex><span> ]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:current-page</span>]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Query the block & page title of certain pages or tags</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;Query for page references &amp; tags.&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:in</span> $ ?page_name
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>       [?b <span style=color:#e6db74>:block/refs</span> ?r]
</span></span><span style=display:flex><span>       [?r <span style=color:#e6db74>:block/name</span> ?page_name]]
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:inputs</span>
</span></span><span style=display:flex><span>       [<span style=color:#e6db74>&#34;mar 28, 2022&#34;</span>]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Always query for current date / today</p><ul><li><p><a href=https://discord.com/channels/725182569297215569/725182570131751005/952597973894848613>Discord Link</a></p></li><li><p><code>{{query &lt;%today%>}}</code></p></li></ul><hr><p>Concatenate all the journal entries of the week in the Friday entry.</p><ul><li><a href=https://discord.com/channels/725182569297215569/743139225746145311/955436664048717855>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;What has been done&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:in</span> $ ?current-page ?start ?today
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         [?b <span style=color:#e6db74>:block/page</span> ?p]
</span></span><span style=display:flex><span>         [?p <span style=color:#e6db74>:page/journal?</span> true]
</span></span><span style=display:flex><span>         [?p <span style=color:#e6db74>:page/journal-day</span> ?d]
</span></span><span style=display:flex><span>         <span style=color:#75715e>;[?p :block/name ?current-page]</span>
</span></span><span style=display:flex><span>         <span style=color:#75715e>;[?p :block/journal-day ?current-page-day]</span>
</span></span><span style=display:flex><span>         [(&gt;= ?d ?start)]
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>or</span>
</span></span><span style=display:flex><span>          [(&lt;= ?d ?current-page)]
</span></span><span style=display:flex><span>          [(&lt;= ?d ?today)])
</span></span><span style=display:flex><span>         ]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:current-page</span> <span style=color:#e6db74>:7d-before</span> <span style=color:#e6db74>:today</span>]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>As I&rsquo;m using NOW/LATER + WAITING approach, my common workflow for tasks life cycle is:</p><ul><li>add something not urgent (and visually &ldquo;muted&rdquo;) with WAITING without date</li><li>add common task with LATER + plan it if needed with deadline\scheduled</li><li>add current\urgent task with NOW &ndash;> work on it &ndash;> finish with DONE</li><li>take overdued tasks</li><li>take some LATER task &ndash;> delete planed date if it was &ndash;> set it to NOW &ndash;> work &ndash;> finish with DONE</li></ul><p>I was trying to mix 2 layers of tasks planning as you can see - task status cycle and &ldquo;calendared&rdquo; items:</p><ul><li><p>&ldquo;what is overdued?&rdquo;</p></li><li><p>&ldquo;what should I do today?&rdquo;</p></li><li><p>&ldquo;what should I do tomorrow?&rdquo;</p></li><li><p>&ldquo;what can I do next?&rdquo;</p></li><li><p>&ldquo;what is WAITING?&rdquo;</p><ul><li><strong>PS</strong>: no sorting in queries, as i want to see parent pages links 😒 #.v-gallery-h400-fit</li></ul></li></ul><p><img loading=lazy src=https://media.discordapp.net/attachments/756886540038438992/955475162537558046/unknown.png alt></p><p><img loading=lazy src="https://media.discordapp.net/attachments/756886540038438992/955475162734657566/z.png?width=484&amp;height=905" alt></p><ul><li>✅ wanna have block answering my question &ldquo;what is overdued?&rdquo;<ul><li>anything task calendared before today</li><li>also as this block can called &ldquo;attention&rdquo; - I&rsquo;m searching for &ldquo;wrong&rdquo; tasks calendared NOW(it should no have date, as described before)</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:title</span>
</span></span><span style=display:flex><span>        [[<span style=color:#e6db74>:strong</span> <span style=color:#e6db74>&#34;🔥 Overdue&#34;</span>] [<span style=color:#e6db74>:span</span> <span style=color:#e6db74>&#34; or &#34;</span>] [<span style=color:#e6db74>:span.block-marker.NOW</span> <span style=color:#e6db74>&#34;NOW&#34;</span>] [<span style=color:#e6db74>:sup</span> <span style=color:#e6db74>&#34;(with-date)&#34;</span>]]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:query</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?block [*])
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:in</span> $ ?start ?next
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>            [?block <span style=color:#e6db74>:block/marker</span> ?m]
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>or-join</span> [?block ?start ?next ?m] 
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>and</span>
</span></span><span style=display:flex><span>                    (or [?block <span style=color:#e6db74>:block/scheduled</span> ?d] [?block <span style=color:#e6db74>:block/deadline</span> ?d])
</span></span><span style=display:flex><span>                    [(&gt; ?d ?start)]
</span></span><span style=display:flex><span>                    [(&lt; ?d ?next)]
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                <span style=color:#75715e>;;</span>
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>and</span>
</span></span><span style=display:flex><span>                    [(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;NOW&#34;</span>} ?m)]
</span></span><span style=display:flex><span>                    (or [?block <span style=color:#e6db74>:block/scheduled</span> ?d] [?block <span style=color:#e6db74>:block/deadline</span> ?d])
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:365d-before</span> <span style=color:#e6db74>:today</span>]
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:breadcrumb-show?</span> false
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:collapsed?</span> false
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li>✅ wanna have block answering my question &ldquo;what should i do today?&rdquo;<ul><li>not calendared status NOW = today</li><li>status LATER with date today</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:title</span>
</span></span><span style=display:flex><span>        [[<span style=color:#e6db74>:strong</span> <span style=color:#e6db74>&#34;⏰ Today&#34;</span>] [<span style=color:#e6db74>:span</span> <span style=color:#e6db74>&#34; or &#34;</span>] [<span style=color:#e6db74>:span.block-marker.NOW</span> <span style=color:#e6db74>&#34;NOW&#34;</span>]]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:query</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?block [*])
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:in</span> $ ?day
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>            [?block <span style=color:#e6db74>:block/marker</span> ?m]
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>or-join</span> [?block ?day ?m] 
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>and</span>
</span></span><span style=display:flex><span>                    [(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;LATER&#34;</span>} ?m)]
</span></span><span style=display:flex><span>                    (or [?block <span style=color:#e6db74>:block/scheduled</span> ?d] [?block <span style=color:#e6db74>:block/deadline</span> ?d])
</span></span><span style=display:flex><span>                    [(= ?d ?day)]
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                <span style=color:#75715e>;;</span>
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>and</span>
</span></span><span style=display:flex><span>                    [(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;NOW&#34;</span>} ?m)]
</span></span><span style=display:flex><span>                    [(<span style=color:#a6e22e>missing?</span> $ ?block <span style=color:#e6db74>:block/scheduled</span>)]
</span></span><span style=display:flex><span>                    [(<span style=color:#a6e22e>missing?</span> $ ?block <span style=color:#e6db74>:block/deadline</span>)]
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:today</span>]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:breadcrumb-show?</span> false
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:collapsed?</span> false
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li>✅ wanna have block answering my question &ldquo;what should i do tomorrow?&rdquo;<ul><li>LATER with date tomorrow</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:title</span>
</span></span><span style=display:flex><span>        [<span style=color:#e6db74>:strong</span> <span style=color:#e6db74>&#34;🌞 Tomorrow&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:query</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?block [*])
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:in</span> $ ?day
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>            [?block <span style=color:#e6db74>:block/marker</span> ?m]
</span></span><span style=display:flex><span>            [(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;LATER&#34;</span>} ?m)]
</span></span><span style=display:flex><span>            (or [?block <span style=color:#e6db74>:block/scheduled</span> ?d] [?block <span style=color:#e6db74>:block/deadline</span> ?d])
</span></span><span style=display:flex><span>            [(= ?d ?day)]
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:1d-after</span>]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:breadcrumb-show?</span> false
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:collapsed?</span> false
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li>✅ wanna have block answering my question &ldquo;what can i do next?&rdquo;<ul><li>not calendared with status LATER = next</li><li>any status with date after tomorrow = next</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:title</span>
</span></span><span style=display:flex><span>        [[<span style=color:#e6db74>:strong</span> <span style=color:#e6db74>&#34;📅 This week&#34;</span>] [<span style=color:#e6db74>:span</span> <span style=color:#e6db74>&#34; or &#34;</span>] [<span style=color:#e6db74>:span.block-marker.LATER</span> <span style=color:#e6db74>&#34;LATER&#34;</span>] [<span style=color:#e6db74>:sup</span> <span style=color:#e6db74>&#34;(without-date)&#34;</span>]]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:query</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?block [*])
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:in</span> $ ?start ?next
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>or-join</span> [?block ?start ?next] 
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>and</span>
</span></span><span style=display:flex><span>                    (or [?block <span style=color:#e6db74>:block/scheduled</span> ?d] [?block <span style=color:#e6db74>:block/deadline</span> ?d])
</span></span><span style=display:flex><span>                    [(&gt; ?d ?start)]
</span></span><span style=display:flex><span>                    [(&lt; ?d ?next)]
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                <span style=color:#75715e>;;</span>
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>and</span>
</span></span><span style=display:flex><span>                    [?block <span style=color:#e6db74>:block/marker</span> ?m]
</span></span><span style=display:flex><span>                    [(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;LATER&#34;</span>} ?m)]
</span></span><span style=display:flex><span>                    [(<span style=color:#a6e22e>missing?</span> $ ?block <span style=color:#e6db74>:block/scheduled</span>)]
</span></span><span style=display:flex><span>                    [(<span style=color:#a6e22e>missing?</span> $ ?block <span style=color:#e6db74>:block/deadline</span>)]
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:1d-after</span> <span style=color:#e6db74>:7d-after</span>]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:breadcrumb-show?</span> false
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:collapsed?</span> false
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li>✅ wanna have block answering my question &ldquo;what is WAITING?&rdquo; (collapsed, to not blow my eyes)<ul><li>not calendared with status WAITING</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:title</span>
</span></span><span style=display:flex><span>        [<span style=color:#e6db74>:strong</span> <span style=color:#e6db74>&#34;⏳ Waiting&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:query</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?block [*])
</span></span><span style=display:flex><span>        <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>            [?block <span style=color:#e6db74>:block/marker</span> ?marker]
</span></span><span style=display:flex><span>            [(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;WAITING&#34;</span>} ?marker)]
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:breadcrumb-show?</span> false
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:collapsed?</span> true
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Add HTML markup to query title</p><ul><li><p><a href=https://discord.com/channels/725182569297215569/743139225746145311/955453273077338202>Discord Link</a></p></li><li><p><a href=https://discord.com/channels/725182569297215569/743139225746145311/955453575310499840>Discord Link</a></p></li><li><p><a href=https://github.com/weavejester/hiccup/wiki/Syntax>hiccup wiki</a></p></li><li><p><a href=https://github.com/yokolet/hiccup-samples>hiccup-samples</a></p></li></ul><hr><p>page for pdf files has property <code>:file</code> and <code>:file-path</code>:</p><ul><li><a href=https://discord.com/channels/725182569297215569/743139225746145311/957340667292577802>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?p [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         [has-page-property ?p <span style=color:#e6db74>:file</span>]
</span></span><span style=display:flex><span>       ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Find all unlinked pages/orphaned nodes</p><ul><li><a href=https://discord.com/channels/725182569297215569/743139225746145311/832512082289229824>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;orphan pages&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> ?name
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         [?p <span style=color:#e6db74>:page/name</span> ?name]
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>not</span>
</span></span><span style=display:flex><span>          [?b <span style=color:#e6db74>:block/ref-pages</span> ?p1]
</span></span><span style=display:flex><span>          [?b <span style=color:#e6db74>:block/page</span> ?p2]
</span></span><span style=display:flex><span>          (or [?p1 <span style=color:#e6db74>:page/name</span> ?name]
</span></span><span style=display:flex><span>              [?p2 <span style=color:#e6db74>:page/name</span> ?name]))]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:view</span> (<span style=color:#66d9ef>fn </span>[result]
</span></span><span style=display:flex><span>         [<span style=color:#e6db74>:div.flex.flex-col</span>
</span></span><span style=display:flex><span>          (for [page result]
</span></span><span style=display:flex><span>            [<span style=color:#e6db74>:a</span> {<span style=color:#e6db74>:href</span> (str <span style=color:#e6db74>&#34;#/page/&#34;</span> page)} (<span style=color:#a6e22e>clojure.string/capitalize</span> page)])])}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Use query in a template.</p><ul><li><a href=https://discord.com/channels/725182569297215569/743139225746145311/960623468347527208**>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span> {<span style=color:#e6db74>:title</span> [<span style=color:#e6db74>:b</span> <span style=color:#e6db74>&#34;&lt;%current page%&gt;&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:in</span> $ ?current-page
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>    [?b <span style=color:#e6db74>:block/path-refs</span> ?name]   
</span></span><span style=display:flex><span>    [?name <span style=color:#e6db74>:block/name</span> ?current-page]          
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:current-page</span>]
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:breadcrumb-show?</span> false
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Query for <strong>icon page property</strong>.</p><ul><li><a href=https://discord.com/channels/725182569297215569/766475028978991104/961743401152286770>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span> {<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?p [*])
</span></span><span style=display:flex><span> <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>    [?p <span style=color:#e6db74>:block/properties</span> ?prop]
</span></span><span style=display:flex><span>    [(get ?prop <span style=color:#e6db74>:icon</span>) ?icon]
</span></span><span style=display:flex><span>     <span style=color:#75715e>; [(= &#34;example&#34; ?type)]` </span>
</span></span><span style=display:flex><span>     ]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Get scheduled tasks within a namespace.</p><ul><li><a href=https://discord.com/channels/725182569297215569/743139225746145311/962006699223429260>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34; Scheduled dates in Golf namespace&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span><span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>[?b <span style=color:#e6db74>:block/scheduled</span> ?d]
</span></span><span style=display:flex><span>[?b <span style=color:#e6db74>:block/marker</span> ?marker]
</span></span><span style=display:flex><span>[?b <span style=color:#e6db74>:block/page</span> ?p]
</span></span><span style=display:flex><span>[?p <span style=color:#e6db74>:block/namespace</span> ?ns]
</span></span><span style=display:flex><span>[?ns <span style=color:#e6db74>:block/name</span> ?nsn]
</span></span><span style=display:flex><span>[(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;golf&#34;</span>} ?nsn)]]
</span></span><span style=display:flex><span><span style=color:#e6db74>:collapsed?</span> false}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li><code>:block/namespace</code> are page property and <code>:block/name</code> are lowercase version of <code>:block/original-name</code>(page-name)</li></ul><hr><p>Filter the page with time/timestamp.</p><ul><li><p><a href=https://discord.com/channels/725182569297215569/743139225746145311/963473363043512390>Discord Link</a></p></li><li><p><strong>Ozark/S04/Part 1</strong></p></li></ul><pre tabindex=0><code>title:: Ozark/S04/Part 1
status:: #towatch
type:: series
genre:: Crime, Drama, Thriller 
tags:: Netflix
release_timestamp:: 1642723200000
release_smushed:: 20220121
</code></pre><ul><li><strong>Ozark/S04/Part 2</strong></li></ul><pre tabindex=0><code>title:: Ozark/S04/Part 2
status:: #towatch
type:: series
genre:: Crime, Drama, Thriller 
tags:: Netflix
release_timestamp:: 1651190400000
release_smushed:: 20220429
</code></pre><ul><li>Query for timestamp</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;Unreleased Shows&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?p [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:in</span> $ ?today
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>page-property</span> ?p <span style=color:#e6db74>:type</span> <span style=color:#e6db74>&#34;series&#34;</span>)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>page-property</span> ?p <span style=color:#e6db74>:status</span> <span style=color:#e6db74>&#34;towatch&#34;</span>)
</span></span><span style=display:flex><span>         [?p <span style=color:#e6db74>:block/properties</span> ?props]
</span></span><span style=display:flex><span>         [(get ?props <span style=color:#e6db74>:release-timestamp</span>) ?d]
</span></span><span style=display:flex><span>         [(&gt;  ?d ?today)]
</span></span><span style=display:flex><span>         ]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:right-now-ms</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li>Query for yyyyMMdd</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> <span style=color:#e6db74>&#34;Unreleased Shows&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?p [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:in</span> $ ?today
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>page-property</span> ?p <span style=color:#e6db74>:type</span> <span style=color:#e6db74>&#34;series&#34;</span>)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>page-property</span> ?p <span style=color:#e6db74>:status</span> <span style=color:#e6db74>&#34;towatch&#34;</span>)
</span></span><span style=display:flex><span>         [?p <span style=color:#e6db74>:block/properties</span> ?props]
</span></span><span style=display:flex><span>         [(get ?props <span style=color:#e6db74>:release-smushed</span>) ?d]
</span></span><span style=display:flex><span>         [(&gt;  ?d ?today)]
</span></span><span style=display:flex><span>         ]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:today</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><pre><code>+ 
</code></pre><hr><p>Using journal-date format in page property and query it.</p><ul><li><p><a href=https://discord.com/channels/725182569297215569/743139225746145311/963685777122930698>Discord Link</a></p></li><li><p><a href=https://discord.com/channels/725182569297215569/743139225746145311/963722478973243404>Discord Link</a></p></li><li><p>just tested it with different journal-date format. replace <code>[?p :block/name ?n]</code> with <code>[?p :block/original-name ?n]</code>. date value are stored in property with <code>original-name</code>.</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{<span style=color:#e6db74>:title</span> [<span style=color:#e6db74>&#34;Unreleased Shows&#34;</span>]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?p2 [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:in</span> $ ?today
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         [?p2 <span style=color:#e6db74>:block/name</span> _]
</span></span><span style=display:flex><span>         [?p2 <span style=color:#e6db74>:block/properties</span> ?prop]
</span></span><span style=display:flex><span>         [(get ?prop <span style=color:#e6db74>:release</span>) ?rel]
</span></span><span style=display:flex><span>         [?p <span style=color:#e6db74>:block/original-name</span> ?n]
</span></span><span style=display:flex><span>         [(contains? ?rel ?n)]
</span></span><span style=display:flex><span>         [?p <span style=color:#e6db74>:block/journal-day</span> ?d]
</span></span><span style=display:flex><span>         [(&gt; ?d ?today)]
</span></span><span style=display:flex><span>         [(get ?prop <span style=color:#e6db74>:type</span>) ?type]
</span></span><span style=display:flex><span>         [(contains? <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;series&#34;</span>} ?type)]
</span></span><span style=display:flex><span>         [(get ?prop <span style=color:#e6db74>:status</span>) ?status]
</span></span><span style=display:flex><span>         [(= <span style=color:#f92672>#</span>{<span style=color:#e6db74>&#34;towatch&#34;</span>} ?status)]]
</span></span><span style=display:flex><span> <span style=color:#e6db74>:inputs</span> [<span style=color:#e6db74>:today</span>]}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Have a <code>property</code> field that I only fill with numbers (floats). Is it possible to pull blocks where this field is within a range (say 20 &lt; x &lt; 50, or just x > 100).</p><ul><li><a href=https://discord.com/channels/725182569297215569/743139225746145311/966146506392473640>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         [?b <span style=color:#e6db74>:block/properties</span> ?prop]
</span></span><span style=display:flex><span>         [(get ?prop <span style=color:#e6db74>:num-prop</span>) ?num]
</span></span><span style=display:flex><span>         [(&gt; ?num <span style=color:#ae81ff>100</span>)]
</span></span><span style=display:flex><span>       ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li>for 20&lt;x&lt;50 replace <code>[(> ?num 100)]</code> with</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>         [(&lt; ?num <span style=color:#ae81ff>50</span>)]
</span></span><span style=display:flex><span>         [(&gt; ?num <span style=color:#ae81ff>20</span>)]
</span></span></code></pre></div><ul><li>float function doesn&rsquo;t recognized, so multiply property by 1.0</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         [?b <span style=color:#e6db74>:block/properties</span> ?prop]
</span></span><span style=display:flex><span>         [(get ?prop <span style=color:#e6db74>:num-prop</span>) ?num]
</span></span><span style=display:flex><span>         [(* <span style=color:#ae81ff>1.0</span> ?num) ?numf]
</span></span><span style=display:flex><span>         [(&lt; ?numf <span style=color:#ae81ff>50</span>)]
</span></span><span style=display:flex><span>         [(&gt; ?numf <span style=color:#ae81ff>20</span>)]
</span></span><span style=display:flex><span>       ]
</span></span><span style=display:flex><span>}<span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><ul><li></li></ul><hr><p>Query tasks which are recurring.</p><ul><li><a href=https://discord.com/channels/725182569297215569/743139225746145311/966350378172035072>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?b [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         [?b <span style=color:#e6db74>:block/repeated?</span>]
</span></span><span style=display:flex><span>       ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr><p>Query to get second block.</p><ul><li><a href=https://discord.com/channels/725182569297215569/743139225746145311/966502226589777920>Discord Link</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span><span style=color:#f92672>#</span>+BEGIN_QUERY
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span> <span style=color:#e6db74>:query</span> [<span style=color:#e6db74>:find</span> (<span style=color:#a6e22e>pull</span> ?bl [*])
</span></span><span style=display:flex><span>         <span style=color:#e6db74>:where</span>
</span></span><span style=display:flex><span>         [?b <span style=color:#e6db74>:block/pre-block?</span>]
</span></span><span style=display:flex><span>         [?bl <span style=color:#e6db74>:block/left</span> ?b]
</span></span><span style=display:flex><span>       ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>+END_QUERY
</span></span></code></pre></div><hr></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://charleschiugit.github.io/>Charles Chiu</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>